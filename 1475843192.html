<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="theme-color" content="#222">
    <meta name="generator" content="Hexo 4.2.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16-next.png">
    <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#222">
    <meta name="msapplication-config" content="/images/favicon/browserconfig.xml">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
    <link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css">
    <script src="/lib/pace/pace.min.js"></script>
    <script id="hexo-configurations">
        var NexT = window.NexT ||
        {};
        var CONFIG = {
            "hostname": "paynewu.com",
            "root": "/",
            "scheme": "Gemini",
            "version": "7.8.0",
            "exturl": false,
            "sidebar":
            {
                "position": "right",
                "width": 240,
                "display": "post",
                "padding": 18,
                "offset": 12,
                "onmobile": false
            },
            "copycode":
            {
                "enable": true,
                "show_result": true,
                "style": "mac"
            },
            "back2top":
            {
                "enable": true,
                "sidebar": false,
                "scrollpercent": true
            },
            "bookmark":
            {
                "enable": false,
                "color": "#222",
                "save": "auto"
            },
            "fancybox": false,
            "mediumzoom": true,
            "lazyload": false,
            "pangu": true,
            "comments":
            {
                "style": "tabs",
                "active": "valine",
                "storage": true,
                "lazyload": false,
                "nav": null
            },
            "algolia":
            {
                "hits":
                {
                    "per_page": 10
                },
                "labels":
                {
                    "input_placeholder": "Search for Posts",
                    "hits_empty": "We didn't find any results for the search: ${query}",
                    "hits_stats": "${hits} results found in ${time} ms"
                }
            },
            "localsearch":
            {
                "enable": true,
                "trigger": "auto",
                "top_n_per_article": 8,
                "unescape": false,
                "preload": false
            },
            "motion":
            {
                "enable": false,
                "async": false,
                "transition":
                {
                    "post_block": "bounceDownIn",
                    "post_header": "slideDownIn",
                    "post_body": "slideDownIn",
                    "coll_header": "slideLeftIn",
                    "sidebar": "slideUpIn"
                }
            },
            "path": "search.xml"
        };

    </script>
    <meta name="description" content="无路是在开发、测试、亦或者调试有一好的日志，都会事半功倍。本节我来学习一下 go 语言明星日志库 logrus。相关链接如下所示github: https:&#x2F;&#x2F;github.com&#x2F;sirupsen&#x2F;logruspkg： https:&#x2F;&#x2F;pkg.go.dev&#x2F;logur.dev&#x2F;adapter&#x2F;logrus Logrus 简介 Logrus 是 Go 语言结构化的 logger，与标准库 logg">
    <meta property="og:type" content="article">
    <meta property="og:title" content="go日志库之logrus">
    <meta property="og:url" content="https://paynewu.com/1475843192.html">
    <meta property="og:site_name" content="吴志鹏｜Payne-Wu">
    <meta property="og:description" content="无路是在开发、测试、亦或者调试有一好的日志，都会事半功倍。本节我来学习一下 go 语言明星日志库 logrus。相关链接如下所示github: https:&#x2F;&#x2F;github.com&#x2F;sirupsen&#x2F;logruspkg： https:&#x2F;&#x2F;pkg.go.dev&#x2F;logur.dev&#x2F;adapter&#x2F;logrus Logrus 简介 Logrus 是 Go 语言结构化的 logger，与标准库 logg">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1guu60plma8j60l00740to02.jpg">
    <meta property="article:published_time" content="2021-09-24T22:59:56.000Z">
    <meta property="article:modified_time" content="2022-07-27T09:58:26.880Z">
    <meta property="article:author" content="吴志鹏">
    <meta property="article:tag" content="Go">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1guu60plma8j60l00740to02.jpg">
    <link rel="canonical" href="https://paynewu.com/1475843192.html">
    <script id="page-configurations">
        // https://hexo.io/docs/variables.html
        CONFIG.page = {
            sidebar: "",
            isHome: false,
            isPost: true,
            lang: 'zh-CN'
        };

    </script>
    <title>go日志库之logrus | 吴志鹏｜Payne-Wu</title>
    <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
    <noscript>
        <style>
            .use-motion .brand,
            .use-motion .menu-item,
            .sidebar-inner,
            .use-motion .post-block,
            .use-motion .pagination,
            .use-motion .comments,
            .use-motion .post-header,
            .use-motion .post-body,
            .use-motion .collection-header
            {
                opacity: initial;
            }

            .use-motion .site-title,
            .use-motion .site-subtitle
            {
                opacity: initial;
                top: initial;
            }

            .use-motion .logo-line-before i
            {
                left: initial;
            }

            .use-motion .logo-line-after i
            {
                right: initial;
            }

        </style>
    </noscript>
    <link rel="alternate" href="/atom.xml" title="吴志鹏｜Payne-Wu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
    <div class="container">
        <div class="headband"></div>
        <header class="header" itemscope itemtype="http://schema.org/WPHeader">
            <div class="header-inner">
                <div class="site-brand-container">
                    <div class="site-nav-toggle">
                        <div class="toggle" aria-label="切换导航栏">
                            <span class="toggle-line toggle-line-first"></span>
                            <span class="toggle-line toggle-line-middle"></span>
                            <span class="toggle-line toggle-line-last"></span>
                        </div>
                    </div>
                    <div class="site-meta">
                        <a href="/" class="brand" rel="start">
                            <span class="logo-line-before"><i></i></span>
                            <h1 class="site-title">吴志鹏｜Payne-Wu </h1>
                            <span class="logo-line-after"><i></i></span>
                        </a>
                    </div>
                    <div class="site-nav-right">
                        <div class="toggle popup-trigger">
                            <i class="fa fa-search fa-fw fa-lg"></i>
                        </div>
                    </div>
                </div>
                <nav class="site-nav">
                    <ul id="menu" class="main-menu menu">
                        <li class="menu-item menu-item-home">
                            <a href="/" rel="section">首页</a>
                        </li>
                        <li class="menu-item menu-item-archives">
                            <a href="/archives/" rel="section">文章列表</a>
                        </li>
                        <li class="menu-item menu-item-tags">
                            <a href="/tags/" rel="section">Tags Cloud</a>
                        </li>
                        <li class="menu-item menu-item-categories">
                            <a href="/categories/" rel="section">文章集合</a>
                        </li>
                        <li class="menu-item menu-item-about">
                            <a href="/about/" rel="section">关于我啊</a>
                        </li>
                        <li class="menu-item menu-item-message">
                            <a href="/message/" rel="section">留言与我</a>
                        </li>
                        <li class="menu-item menu-item-search">
                            <a role="button" class="popup-trigger">搜索 </a>
                        </li>
                    </ul>
                </nav>
                <div class="search-pop-overlay">
                    <div class="popup search-popup">
                        <div class="search-header">
                            <span class="search-icon">
                                <i class="fa fa-search"></i>
                            </span>
                            <div class="search-input-container">
                                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
                            </div>
                            <span class="popup-btn-close">
                                <i class="fa fa-times-circle"></i>
                            </span>
                        </div>
                        <div id="search-result">
                            <div id="no-result">
                                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div class="back-to-top">
            <i class="fa fa-arrow-up"></i>
            <span>0%</span>
        </div>
        <div class="reading-progress-bar"></div>
        <main class="main">
            <div class="main-inner">
                <div class="content-wrap">
                    <div class="content post posts-expand">
                        <article itemscope itemtype="http://schema.org/Article" class="post-block single" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1475843192.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h1 class="post-title" itemprop="name headline"> go日志库之logrus </h1>
                                <div class="post-meta">
                                    <span class="post-meta-item">
                                        <span class="post-meta-item-icon">
                                            <i class="far fa-user"></i>
                                        </span>
                                        <span class="post-meta-item-text">作者</span>
                                        <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                    </span>
                                    <span class="post-meta-item">
                                        <span class="post-meta-item-icon">
                                            <i class="far fa-calendar"></i>
                                        </span>
                                        <span class="post-meta-item-text">发表于</span>
                                        <time title="创建时间：2021-09-25 06:59:56" itemprop="dateCreated datePublished" datetime="2021-09-25T06:59:56+08:00">2021-09-25</time>
                                    </span>
                                    <span class="post-meta-item">
                                        <span class="post-meta-item-icon">
                                            <i class="far fa-folder"></i>
                                        </span>
                                        <span class="post-meta-item-text">分类于</span>
                                        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                                            <a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                                        </span>
                                    </span>
                                    <br>
                                    <span class="post-meta-item" title="本文字数">
                                        <span class="post-meta-item-icon">
                                            <i class="far fa-file-word"></i>
                                        </span>
                                        <span class="post-meta-item-text">本文字数：</span>
                                        <span>1.7k</span>
                                    </span>
                                    <span class="post-meta-item" title="阅读时长">
                                        <span class="post-meta-item-icon">
                                            <i class="far fa-clock"></i>
                                        </span>
                                        <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                        <span>2 分钟</span>
                                    </span>
                                </div>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <p>无路是在开发、测试、亦或者调试有一好的日志，都会事半功倍。本节我来学习一下 go 语言明星日志库 logrus。相关链接如下所示<br><a href="https://github.com/sirupsen/logrus" target="_blank" rel="noopener" title="github">github</a>: <a href="https://github.com/sirupsen/logrus" target="_blank" rel="noopener">https://github.com/sirupsen/logrus</a><br><a href="https://pkg.go.dev/logur.dev/adapter/logrus" target="_blank" rel="noopener" title="pkg">pkg</a>： <a href="https://pkg.go.dev/logur.dev/adapter/logrus" target="_blank" rel="noopener">https://pkg.go.dev/logur.dev/adapter/logrus</a></p>
                                <h2 id="Logrus-简介"><a href="#Logrus-简介" class="headerlink" title="Logrus 简介"></a>Logrus 简介</h2>
                                <p>Logrus 是 Go 语言结构化的 logger，与标准库 logger 完全 API 兼容。</p>
                                <p>它有以下特点：</p>
                                <ul>
                                    <li>完全兼容标准日志库，拥有七种日志级别：<code>Trace</code>, <code>Debug</code>, <code>Info</code>, <code>Warning</code>, <code>Error</code>, <code>Fatal</code>and <code>Panic</code>。</li>
                                    <li>可选的日志输出格式，内置了两种日志格式 JSONFormater 和 TextFormatter，还可以自定义日志格式</li>
                                    <li>Field 机制，通过 Filed 机制进行结构化的日志记录</li>
                                    <li>可扩展的 Hook 机制，允许使用者通过 Hook 的方式将日志分发到任意地方，如本地文件系统，logstash，elasticsearch 或者 mq 等，或者通过 Hook 定义日志内容和格式等</li>
                                    <li>线程安全</li>
                                </ul>
                                <h2 id="logrus-的安装"><a href="#logrus-的安装" class="headerlink" title="logrus 的安装"></a>logrus 的安装</h2>
                                <p>logrus 安装也非常的简单，直接使用<code>go get</code>即可，安装命令如下所示</p>
                                <figure class="highlight shell">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line">go get -v -u logur.dev/adapter/logrus</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <blockquote>
                                    <p>其中</p>
                                    <p><code>-v</code> 为显示包安装信息</p>
                                    <p><code>-u</code> 为安装最新版</p>
                                </blockquote>
                                <h2 id="logrus-的使用"><a href="#logrus-的使用" class="headerlink" title="logrus 的使用"></a>logrus 的使用</h2>
                                <p>介绍的包的使用，或许可以从几个维度，初始化、基本使用、骚操作及拓展。源于包使用，但不限于包使用</p>
                                <h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3>
                                <p>logrus 相关于初始化的方面，一共有三种方式。基于<code>New()</code>、<code>Logger</code>、<code>不操作</code></p>
                                <h4 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h4>
                                <p>直接使用相对来说更便捷，更清亮。也是相对来说性能最高的，但不足也显而易言，那就是不能有更自由的操作了，如设置 log Level、Hook、Format 等等。</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line">logrus.Trace(<span class="string">"trace msg"</span>)</span><br><span class="line">logrus.Tracef(<span class="string">"trace %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Debug(<span class="string">"debug msg"</span>)</span><br><span class="line">logrus.Debugf(<span class="string">"debug %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Info(<span class="string">"info msg"</span>)</span><br><span class="line">logrus.Infof(<span class="string">"info %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Warn(<span class="string">"warn msg"</span>)</span><br><span class="line">logrus.Warnf(<span class="string">"warn %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Error(<span class="string">"error msg"</span>)</span><br><span class="line">logrus.Errorf(<span class="string">"error %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Fatal(<span class="string">"fatal msg"</span>)</span><br><span class="line">logrus.Fatalf(<span class="string">"fatal  %v"</span>, <span class="string">"msg"</span>)</span><br><span class="line"></span><br><span class="line">logrus.Panic(<span class="string">"panic msg"</span>)</span><br><span class="line">logrus.Panicf(<span class="string">"panic  %v"</span>, <span class="string">"msg"</span>)</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <blockquote>
                                    <p>当然根据默认的规则会忽略掉一些输出信息</p>
                                </blockquote>
                                <h4 id="使用-New-初始化于定制"><a href="#使用-New-初始化于定制" class="headerlink" title="使用 New 初始化于定制"></a>使用 New 初始化于定制</h4>
                                <p>相对直接使用，使用 New 初始化，拥有更多的操作空间。</p>
                                <p>首先声明一个全局变量<code>log</code>，代码如下所示</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="keyword">var</span> log = logrus.New()</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p>常规情况下对于日志的定制主要在以下几个方面</p>
                                <ul>
                                    <li>日志可见等级</li>
                                    <li>日志格式配置</li>
                                    <li>执行调用信息</li>
                                    <li>日志另存为</li>
                                </ul>
                                <p><strong>日志可见等级</strong></p>
                                <blockquote>
                                    <p>相关源码如下</p>
                                </blockquote>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	<span class="comment">// PanicLevel level, highest level of severity. Logs and then calls panic with the</span></span><br><span class="line">	<span class="comment">// message passed to Debug, Info, ...</span></span><br><span class="line">	PanicLevel Level = <span class="literal">iota</span></span><br><span class="line">	<span class="comment">// FatalLevel level. Logs and then calls `logger.Exit(1)`. It will exit even if the</span></span><br><span class="line">	<span class="comment">// logging level is set to Panic.</span></span><br><span class="line">	FatalLevel</span><br><span class="line">	<span class="comment">// ErrorLevel level. Logs. Used for errors that should definitely be noted.</span></span><br><span class="line">	<span class="comment">// Commonly used for hooks to send errors to an error tracking service.</span></span><br><span class="line">	ErrorLevel</span><br><span class="line">	<span class="comment">// WarnLevel level. Non-critical entries that deserve eyes.</span></span><br><span class="line">	WarnLevel</span><br><span class="line">	<span class="comment">// InfoLevel level. General operational entries about what's going on inside the</span></span><br><span class="line">	<span class="comment">// application.</span></span><br><span class="line">	InfoLevel</span><br><span class="line">	<span class="comment">// DebugLevel level. Usually only enabled when debugging. Very verbose logging.</span></span><br><span class="line">	DebugLevel</span><br><span class="line">	<span class="comment">// TraceLevel level. Designates finer-grained informational events than the Debug.</span></span><br><span class="line">	TraceLevel</span><br><span class="line">)</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p>简而言之，登记越高（数字越大），显示的等级越全。如 6 显示所有的日志，0 只显示<code>Panic</code></p>
                                <p>设置可见等级之需要在<code>log.SetLevel()</code><em>（log 为<code>var log = logrus.New()</code>而来）</em>设置整形(6-0)即可。</p>
                                <p><strong>日志格式化配置</strong></p>
                                <p>日志格式化主要分为文本格式化、JSON 格式化、自定义格式化或第三方插件格式化</p>
                                <p>如下</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="comment">// log.SetFormatter(&amp;logrus.TextFormatter&#123;</span></span><br><span class="line"><span class="comment">//		DisableColors: false,</span></span><br><span class="line"><span class="comment">//		FullTimestamp: true,</span></span><br><span class="line"><span class="comment">//	&#125;)</span></span><br><span class="line"><span class="keyword">type</span> TextFormatter <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Set to true to bypass checking for a TTY before outputting colors.</span></span><br><span class="line">	ForceColors <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Force disabling colors.</span></span><br><span class="line">	DisableColors <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Force quoting of all values</span></span><br><span class="line">	ForceQuote <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableQuote disables quoting for all values.</span></span><br><span class="line">	<span class="comment">// DisableQuote will have a lower priority than ForceQuote.</span></span><br><span class="line">	<span class="comment">// If both of them are set to true, quote will be forced on all values.</span></span><br><span class="line">	DisableQuote <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Override coloring based on CLICOLOR and CLICOLOR_FORCE. - https://bixense.com/clicolors/</span></span><br><span class="line">	EnvironmentOverrideColors <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Disable timestamp logging. useful when output is redirected to logging</span></span><br><span class="line">	<span class="comment">// system that already adds timestamps.</span></span><br><span class="line">	DisableTimestamp <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Enable logging the full timestamp when a TTY is attached instead of just</span></span><br><span class="line">	<span class="comment">// the time passed since beginning of execution.</span></span><br><span class="line">	FullTimestamp <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TimestampFormat to use for display when a full timestamp is printed.</span></span><br><span class="line">	<span class="comment">// The format to use is the same than for time.Format or time.Parse from the standard</span></span><br><span class="line">	<span class="comment">// library.</span></span><br><span class="line">	<span class="comment">// The standard Library already provides a set of predefined format.</span></span><br><span class="line">	TimestampFormat <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The fields are sorted by default for a consistent output. For applications</span></span><br><span class="line">	<span class="comment">// that log extremely frequently and don't use the JSON formatter this may not</span></span><br><span class="line">	<span class="comment">// be desired.</span></span><br><span class="line">	DisableSorting <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The keys sorting function, when uninitialized it uses sort.Strings.</span></span><br><span class="line">	SortingFunc <span class="function"><span class="keyword">func</span><span class="params">([]<span class="keyword">string</span>)</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Disables the truncation of the level text to 4 characters.</span></span><br><span class="line">	DisableLevelTruncation <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// PadLevelText Adds padding the level text so that all the levels output at the same length</span></span><br><span class="line">	<span class="comment">// PadLevelText is a superset of the DisableLevelTruncation option</span></span><br><span class="line">	PadLevelText <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// QuoteEmptyFields will wrap empty fields in quotes if true</span></span><br><span class="line">	QuoteEmptyFields <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Whether the logger's out is to a terminal</span></span><br><span class="line">	isTerminal <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// FieldMap allows users to customize the names of keys for default fields.</span></span><br><span class="line">	<span class="comment">// As an example:</span></span><br><span class="line">	<span class="comment">// formatter := &amp;TextFormatter&#123;</span></span><br><span class="line">	<span class="comment">//     FieldMap: FieldMap&#123;</span></span><br><span class="line">	<span class="comment">//         FieldKeyTime:  "@timestamp",</span></span><br><span class="line">	<span class="comment">//         FieldKeyLevel: "@level",</span></span><br><span class="line">	<span class="comment">//         FieldKeyMsg:   "@message"&#125;&#125;</span></span><br><span class="line">	FieldMap FieldMap</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CallerPrettyfier can be set by the user to modify the content</span></span><br><span class="line">	<span class="comment">// of the function and file keys in the data when ReportCaller is</span></span><br><span class="line">	<span class="comment">// activated. If any of the returned value is the empty string the</span></span><br><span class="line">	<span class="comment">// corresponding key will be removed from fields.</span></span><br><span class="line">	CallerPrettyfier <span class="function"><span class="keyword">func</span><span class="params">(*runtime.Frame)</span> <span class="params">(function <span class="keyword">string</span>, file <span class="keyword">string</span>)</span></span></span><br><span class="line"></span><br><span class="line">	terminalInitOnce sync.Once</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The max length of the level text, generated dynamically on init</span></span><br><span class="line">	levelTextMaxLength <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p>格式 JSON 化</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="comment">// log.SetFormatter(&amp;logrus.JSONFormatter&#123;&#125;)</span></span><br><span class="line"><span class="keyword">type</span> JSONFormatter <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// TimestampFormat sets the format used for marshaling timestamps.</span></span><br><span class="line">	<span class="comment">// The format to use is the same than for time.Format or time.Parse from the standard</span></span><br><span class="line">	<span class="comment">// library.</span></span><br><span class="line">	<span class="comment">// The standard Library already provides a set of predefined format.</span></span><br><span class="line">	TimestampFormat <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableTimestamp allows disabling automatic timestamps in output</span></span><br><span class="line">	DisableTimestamp <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableHTMLEscape allows disabling html escaping in output</span></span><br><span class="line">	DisableHTMLEscape <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DataKey allows users to put all the log entry parameters into a nested dictionary at a given key.</span></span><br><span class="line">	DataKey <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// FieldMap allows users to customize the names of keys for default fields.</span></span><br><span class="line">	<span class="comment">// As an example:</span></span><br><span class="line">	<span class="comment">// formatter := &amp;JSONFormatter&#123;</span></span><br><span class="line">	<span class="comment">//   	FieldMap: FieldMap&#123;</span></span><br><span class="line">	<span class="comment">// 		 FieldKeyTime:  "@timestamp",</span></span><br><span class="line">	<span class="comment">// 		 FieldKeyLevel: "@level",</span></span><br><span class="line">	<span class="comment">// 		 FieldKeyMsg:   "@message",</span></span><br><span class="line">	<span class="comment">// 		 FieldKeyFunc:  "@caller",</span></span><br><span class="line">	<span class="comment">//    &#125;,</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	FieldMap FieldMap</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CallerPrettyfier can be set by the user to modify the content</span></span><br><span class="line">	<span class="comment">// of the function and file keys in the json data when ReportCaller is</span></span><br><span class="line">	<span class="comment">// activated. If any of the returned value is the empty string the</span></span><br><span class="line">	<span class="comment">// corresponding key will be removed from json fields.</span></span><br><span class="line">	CallerPrettyfier <span class="function"><span class="keyword">func</span><span class="params">(*runtime.Frame)</span> <span class="params">(function <span class="keyword">string</span>, file <span class="keyword">string</span>)</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// PrettyPrint will indent all json logs</span></span><br><span class="line">	PrettyPrint <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p><a href="https://github.com/sirupsen/logrus#formatters" target="_blank" rel="noopener">https://github.com/sirupsen/logrus#formatters</a></p>
                                <p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1guu60plma8j60l00740to02.jpg" alt="image-20210926173746478"></p>
                                <p><strong>写入文件夹 SetOutput</strong></p>
                                <p>O_RDONLY：只读模式(read-only)</p>
                                <p>O_WRONLY：只写模式(write-only)</p>
                                <p>O_RDWR：读写模式(read-write)</p>
                                <p>O_APPEND：追加模式(append)</p>
                                <p>O_CREATE：文件不存在就创建(create a new file if none exists.)</p>
                                <p>O_EXCL：与 O_CREATE 一起用，构成一个新建文件的功能，它要求文件必须不存在(used with O_CREATE, file must not exist)</p>
                                <p>O_SYNC：同步方式打开，即不使用缓存，直接写入硬盘 O_TRUNC：打开并清空文件</p>
                                <p>示例代码如下</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	logDirPath := <span class="string">`log/`</span> + time.Now().Format(<span class="string">"2006-01-02"</span>)</span><br><span class="line">	logFilePath := filepath.Join(logDirPath, time.Now().Format(<span class="string">`15`</span>))</span><br><span class="line">	os.MkdirAll(logFilePath, <span class="number">0775</span>)</span><br><span class="line">	file, err := os.OpenFile(logFilePath + <span class="string">`/`</span> + time.Now().Format(<span class="string">`04`</span>) + <span class="string">`.log`</span>, os.O_RDWR|os.O_CREATE|os.O_APPEND, <span class="number">0644</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Error(<span class="string">`open file error`</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	log.SetOutput(file)</span><br><span class="line">&#125;</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p><code>log.SetReportCaller()</code>: 显示调用关系，开启这个模式会增加性能开销(成本在 20% 到 40% 之间)。</p>
                                <p><strong>Hook</strong></p>
                                <p>logrus 通过实现 <code>Hook</code>接口扩展 hook 机制,可以根据需求将日志分发到任意的存储介质, 比如 es, mq 或者监控报警系统,及时获取异常日志。可以说极大的提高了日志系统的可扩展性。</p>
                                <figure class="highlight go">
                                    <table>
                                        <tr>
                                            <td class="gutter">
                                                <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                            </td>
                                            <td class="code">
                                                <pre><span class="line"><span class="keyword">type</span> Hook <span class="keyword">interface</span> &#123;</span><br><span class="line">  <span class="comment">// 定义哪些等级的日志触发 hook 机制</span></span><br><span class="line">	Levels() []Level</span><br><span class="line">  <span class="comment">// hook 触发器的具体执行操作</span></span><br><span class="line">  <span class="comment">// 如果 Fire 执行失败,错误日志会重定向到标准错误流</span></span><br><span class="line">	Fire(*Entry) error</span><br><span class="line">&#125;</span><br></pre>
                                            </td>
                                        </tr>
                                    </table>
                                </figure>
                                <p>具体 Hook 示列可参考 <a href="https://github.com/sirupsen/logrus/blob/master/hooks/syslog/README.md" target="_blank" rel="noopener">https://github.com/sirupsen/logrus/blob/master/hooks/syslog/README.md</a></p>
                                <h2 id="referer"><a href="#referer" class="headerlink" title="referer"></a>referer</h2>
                                <p><a href="https://blog.csdn.net/wangzhezhilu001/article/details/95363789" target="_blank" rel="noopener">https://blog.csdn.net/wangzhezhilu001/article/details/95363789</a></p>
                                <p><a href="https://blog.csdn.net/sserf/article/details/103388133" target="_blank" rel="noopener">https://blog.csdn.net/sserf/article/details/103388133</a></p>
                            </div>
                            <div class="popular-posts-header">相关文章</div>
                            <ul class="popular-posts">
                                <li class="popular-posts-item">
                                    <div class="popular-posts-title"><a href="/62372.html" rel="bookmark">Golang-Array</a></div>
                                </li>
                                <li class="popular-posts-item">
                                    <div class="popular-posts-title"><a href="/17571.html" rel="bookmark">Golang-Defer详解</a></div>
                                </li>
                                <li class="popular-posts-item">
                                    <div class="popular-posts-title"><a href="/3744.html" rel="bookmark">Golang-Map</a></div>
                                </li>
                                <li class="popular-posts-item">
                                    <div class="popular-posts-title"><a href="/45903.html" rel="bookmark">Golang-匿名函数与闭包</a></div>
                                </li>
                                <li class="popular-posts-item">
                                    <div class="popular-posts-title"><a href="/1962.html" rel="bookmark">Golang-接口(interface)</a></div>
                                </li>
                            </ul>
                            <footer class="post-footer">
                                <div class="post-tags">
                                    <a href="/tags/Go/" rel="tag"><i class="fa fa-tag"></i> Go</a>
                                </div>
                                <div class="post-nav">
                                    <div class="post-nav-item">
                                        <a href="/2341116369.html" rel="prev" title="js调试小笔记">
                                            <i class="fa fa-chevron-left"></i> js调试小笔记 </a>
                                    </div>
                                    <div class="post-nav-item">
                                        <a href="/2559205426.html" rel="next" title="golang配置神器viper"> golang配置神器viper <i class="fa fa-chevron-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </footer>
                        </article>
                    </div>
                    <script>
                        window.addEventListener('tabs:register', () =>
                        {
                            let
                            {
                                activeClass
                            } = CONFIG.comments;
                            if (CONFIG.comments.storage)
                            {
                                activeClass = localStorage.getItem('comments_active') || activeClass;
                            }
                            if (activeClass)
                            {
                                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                                if (activeTab)
                                {
                                    activeTab.click();
                                }
                            }
                        });
                        if (CONFIG.comments.storage)
                        {
                            window.addEventListener('tabs:click', event =>
                            {
                                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                                let commentClass = event.target.classList[1];
                                localStorage.setItem('comments_active', commentClass);
                            });
                        }

                    </script>
                </div>
                <div class="toggle sidebar-toggle">
                    <span class="toggle-line toggle-line-first"></span>
                    <span class="toggle-line toggle-line-middle"></span>
                    <span class="toggle-line toggle-line-last"></span>
                </div>
                <aside class="sidebar">
                    <div class="sidebar-inner">
                        <ul class="sidebar-nav motion-element">
                            <li class="sidebar-nav-toc"> 文章目录 </li>
                            <li class="sidebar-nav-overview"> 站点概览 </li>
                        </ul>
                        <!--noindex-->
                        <div class="post-toc-wrap sidebar-panel">
                            <div class="post-toc motion-element">
                                <ol class="nav">
                                    <li class="nav-item nav-level-2"><a class="nav-link" href="#Logrus-简介"><span class="nav-number">1.</span> <span class="nav-text">Logrus 简介</span></a></li>
                                    <li class="nav-item nav-level-2"><a class="nav-link" href="#logrus-的安装"><span class="nav-number">2.</span> <span class="nav-text">logrus 的安装</span></a></li>
                                    <li class="nav-item nav-level-2"><a class="nav-link" href="#logrus-的使用"><span class="nav-number">3.</span> <span class="nav-text">logrus 的使用</span></a>
                                        <ol class="nav-child">
                                            <li class="nav-item nav-level-3"><a class="nav-link" href="#初始化"><span class="nav-number">3.1.</span> <span class="nav-text">初始化</span></a>
                                                <ol class="nav-child">
                                                    <li class="nav-item nav-level-4"><a class="nav-link" href="#直接使用"><span class="nav-number">3.1.1.</span> <span class="nav-text">直接使用</span></a></li>
                                                    <li class="nav-item nav-level-4"><a class="nav-link" href="#使用-New-初始化于定制"><span class="nav-number">3.1.2.</span> <span class="nav-text">使用 New 初始化于定制</span></a></li>
                                                </ol>
                                            </li>
                                        </ol>
                                    </li>
                                    <li class="nav-item nav-level-2"><a class="nav-link" href="#referer"><span class="nav-number">4.</span> <span class="nav-text">referer</span></a></li>
                                </ol>
                            </div>
                        </div>
                        <!--/noindex-->
                        <div class="site-overview-wrap sidebar-panel">
                            <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <img class="site-author-image" itemprop="image" alt="吴志鹏" src="/images/favicon/android-chrome-512x512.png">
                                <p class="site-author-name" itemprop="name">吴志鹏</p>
                                <div class="site-description" itemprop="description">Talk is free，please state clearly</div>
                            </div>
                            <div class="site-state-wrap motion-element">
                                <nav class="site-state">
                                    <div class="site-state-item site-state-posts">
                                        <a href="/archives/">
                                            <span class="site-state-item-count">136</span>
                                            <span class="site-state-item-name">日志</span>
                                        </a>
                                    </div>
                                    <div class="site-state-item site-state-categories">
                                        <a href="/categories/">
                                            <span class="site-state-item-count">158</span>
                                            <span class="site-state-item-name">分类</span></a>
                                    </div>
                                    <div class="site-state-item site-state-tags">
                                        <a href="/tags/">
                                            <span class="site-state-item-count">89</span>
                                            <span class="site-state-item-name">标签</span></a>
                                    </div>
                                </nav>
                            </div>
                            <div class="links-of-author motion-element">
                                <span class="links-of-author-item">
                                    <a href="https://github.com/Payne-Wu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Payne-Wu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="mailto:wuzhipeng1289690157@gmail.com" title="E-Mail → mailto:wuzhipeng1289690157@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="https://www.zhihu.com/people/wu-zhi-peng-72-78" title="ZhiHu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;wu-zhi-peng-72-78" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>ZhiHu</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="https://weibo.com/u/6987234483" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6987234483" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </aside>
                <div id="sidebar-dimmer"></div>
            </div>
        </main>
        <footer class="footer">
            <div class="footer-inner">
                <div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span>
                    <span class="with-love">
                        <i class="fa fa-heart"></i>
                    </span>
                    <span class="author" itemprop="copyrightHolder">PayneWu</span>
                    <span class="post-meta-divider">|</span>
                    <span class="post-meta-item-icon">
                        <i class="fa fa-chart-area"></i>
                    </span>
                    <span title="站点总字数">255k</span>
                    <span class="post-meta-divider">|</span>
                    <span class="post-meta-item-icon">
                        <i class="fa fa-coffee"></i>
                    </span>
                    <span title="站点阅读时长">3:51</span>
                </div>
                <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备2021019893号-1 </a>
                </div>
                <div style="display: none;">
                    <script src="//s95.cnzz.com/z_stat.php?id=true&web_id=true"></script>
                </div>
            </div>
        </footer>
    </div>
    <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/.js"></script>
    <script src="/js/schemes/pisces.js"></script>
    <script src="/.js"></script>
    <script src="/js/next-boot.js"></script>
    <script src="/.js"></script>
    <script>
        (function ()
        {
            var canonicalURL, curProtocol;
            //Get the <link> tag
            var x = document.getElementsByTagName("link");
            //Find the last canonical URL
            if (x.length > 0)
            {
                for (i = 0; i < x.length; i++)
                {
                    if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
                    {
                        canonicalURL = x[i].href;
                    }
                }
            }
            //Get protocol
            if (!canonicalURL)
            {
                curProtocol = window.location.protocol.split(':')[0];
            }
            else
            {
                curProtocol = canonicalURL.split(':')[0];
            }
            //Get current URL if the canonical URL does not exist
            if (!canonicalURL) canonicalURL = window.location.href;
            //Assign script content. Replace current URL with the canonical URL
            ! function ()
            {
                var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
                    r = canonicalURL,
                    t = document.referrer;
                if (!e.test(r))
                {
                    var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
                    t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
                    var i = new Image;
                    i.src = n
                }
            }(window);
        })();

    </script>
    <script src="/js/local-search.js"></script>
    <script src="/.js"></script>
</body>

</html>
