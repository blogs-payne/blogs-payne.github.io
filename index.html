<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="theme-color" content="#222">
    <meta name="generator" content="Hexo 4.2.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16-next.png">
    <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#222">
    <meta name="msapplication-config" content="/images/favicon/browserconfig.xml">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
    <link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css">
    <script src="/lib/pace/pace.min.js"></script>
    <script id="hexo-configurations">
        var NexT = window.NexT ||
        {};
        var CONFIG = {
            "hostname": "paynewu.com",
            "root": "/",
            "scheme": "Gemini",
            "version": "7.8.0",
            "exturl": false,
            "sidebar":
            {
                "position": "right",
                "width": 240,
                "display": "post",
                "padding": 18,
                "offset": 12,
                "onmobile": false
            },
            "copycode":
            {
                "enable": true,
                "show_result": true,
                "style": "mac"
            },
            "back2top":
            {
                "enable": true,
                "sidebar": false,
                "scrollpercent": true
            },
            "bookmark":
            {
                "enable": false,
                "color": "#222",
                "save": "auto"
            },
            "fancybox": false,
            "mediumzoom": true,
            "lazyload": false,
            "pangu": true,
            "comments":
            {
                "style": "tabs",
                "active": "valine",
                "storage": true,
                "lazyload": false,
                "nav": null
            },
            "algolia":
            {
                "hits":
                {
                    "per_page": 10
                },
                "labels":
                {
                    "input_placeholder": "Search for Posts",
                    "hits_empty": "We didn't find any results for the search: ${query}",
                    "hits_stats": "${hits} results found in ${time} ms"
                }
            },
            "localsearch":
            {
                "enable": true,
                "trigger": "auto",
                "top_n_per_article": 8,
                "unescape": false,
                "preload": false
            },
            "motion":
            {
                "enable": false,
                "async": false,
                "transition":
                {
                    "post_block": "bounceDownIn",
                    "post_header": "slideDownIn",
                    "post_body": "slideDownIn",
                    "coll_header": "slideLeftIn",
                    "sidebar": "slideUpIn"
                }
            },
            "path": "search.xml"
        };

    </script>
    <meta name="description" content="Talk is free，please state clearly">
    <meta property="og:type" content="website">
    <meta property="og:title" content="吴志鹏｜Payne-Wu">
    <meta property="og:url" content="https://paynewu.com/">
    <meta property="og:site_name" content="吴志鹏｜Payne-Wu">
    <meta property="og:description" content="Talk is free，please state clearly">
    <meta property="og:locale" content="zh_CN">
    <meta property="article:author" content="吴志鹏">
    <meta property="article:tag" content="吴志鹏">
    <meta property="article:tag" content="Payne">
    <meta property="article:tag" content="payne-wu">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Golang">
    <meta property="article:tag" content="go">
    <meta property="article:tag" content="spider">
    <meta property="article:tag" content="crawler">
    <meta property="article:tag" content="js">
    <meta property="article:tag" content="爬虫">
    <meta property="article:tag" content=" CloudNative">
    <meta name="twitter:card" content="summary">
    <link rel="canonical" href="https://paynewu.com/">
    <script id="page-configurations">
        // https://hexo.io/docs/variables.html
        CONFIG.page = {
            sidebar: "",
            isHome: true,
            isPost: false,
            lang: 'zh-CN'
        };

    </script>
    <title>吴志鹏｜Payne-Wu</title>
    <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
    <noscript>
        <style>
            .use-motion .brand,
            .use-motion .menu-item,
            .sidebar-inner,
            .use-motion .post-block,
            .use-motion .pagination,
            .use-motion .comments,
            .use-motion .post-header,
            .use-motion .post-body,
            .use-motion .collection-header
            {
                opacity: initial;
            }

            .use-motion .site-title,
            .use-motion .site-subtitle
            {
                opacity: initial;
                top: initial;
            }

            .use-motion .logo-line-before i
            {
                left: initial;
            }

            .use-motion .logo-line-after i
            {
                right: initial;
            }

        </style>
    </noscript>
    <link rel="alternate" href="/atom.xml" title="吴志鹏｜Payne-Wu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
    <div class="container">
        <div class="headband"></div>
        <header class="header" itemscope itemtype="http://schema.org/WPHeader">
            <div class="header-inner">
                <div class="site-brand-container">
                    <div class="site-nav-toggle">
                        <div class="toggle" aria-label="切换导航栏">
                            <span class="toggle-line toggle-line-first"></span>
                            <span class="toggle-line toggle-line-middle"></span>
                            <span class="toggle-line toggle-line-last"></span>
                        </div>
                    </div>
                    <div class="site-meta">
                        <a href="/" class="brand" rel="start">
                            <span class="logo-line-before"><i></i></span>
                            <h1 class="site-title">吴志鹏｜Payne-Wu </h1>
                            <span class="logo-line-after"><i></i></span>
                        </a>
                    </div>
                    <div class="site-nav-right">
                        <div class="toggle popup-trigger">
                            <i class="fa fa-search fa-fw fa-lg"></i>
                        </div>
                    </div>
                </div>
                <nav class="site-nav">
                    <ul id="menu" class="main-menu menu">
                        <li class="menu-item menu-item-home">
                            <a href="/" rel="section">首页</a>
                        </li>
                        <li class="menu-item menu-item-archives">
                            <a href="/archives/" rel="section">文章列表</a>
                        </li>
                        <li class="menu-item menu-item-tags">
                            <a href="/tags/" rel="section">Tags Cloud</a>
                        </li>
                        <li class="menu-item menu-item-categories">
                            <a href="/categories/" rel="section">文章集合</a>
                        </li>
                        <li class="menu-item menu-item-about">
                            <a href="/about/" rel="section">关于我啊</a>
                        </li>
                        <li class="menu-item menu-item-message">
                            <a href="/message/" rel="section">留言与我</a>
                        </li>
                        <li class="menu-item menu-item-search">
                            <a role="button" class="popup-trigger">搜索 </a>
                        </li>
                    </ul>
                </nav>
                <div class="search-pop-overlay">
                    <div class="popup search-popup">
                        <div class="search-header">
                            <span class="search-icon">
                                <i class="fa fa-search"></i>
                            </span>
                            <div class="search-input-container">
                                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
                            </div>
                            <span class="popup-btn-close">
                                <i class="fa fa-times-circle"></i>
                            </span>
                        </div>
                        <div id="search-result">
                            <div id="no-result">
                                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div class="back-to-top">
            <i class="fa fa-arrow-up"></i>
            <span>0%</span>
        </div>
        <div class="reading-progress-bar"></div>
        <main class="main">
            <div class="main-inner">
                <div class="content-wrap">
                    <div class="content index posts-expand">
                        <div class="carousel">
                            <div id="wowslider-container">
                                <div class="ws_images">
                                    <ul>
                                    </ul>
                                </div>
                                <div class="ws_thumbs">
                                    <div>
                                    </div>
                                </div>
                                <div class="ws_shadow"></div>
                            </div>
                        </div>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1840478861.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> 工程化 <i class="label-arrow"></i>
                                    </a>
                                    <a href="/1840478861.html" class="post-title-link" itemprop="url">工程化衍生落地</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Agenda"><a href="#Agenda" class="headerlink" title="Agenda"></a>Agenda</h2>
                                    <ul>
                                        <li>提出需求</li>
                                        <li>调研方案</li>
                                        <li>研读资料</li>
                                        <li>构建工程</li>
                                        <li>实现代码</li>
                                    </ul>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-07-17 22:15:13" itemprop="dateCreated datePublished" datetime="2022-07-17T22:15:13+08:00">2022-07-17</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>26</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/4082705703.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> spider <i class="label-arrow"></i>
                                    </a>
                                    <a href="/4082705703.html" class="post-title-link" itemprop="url">爬虫架构</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="爬虫架构"><a href="#爬虫架构" class="headerlink" title="爬虫架构"></a>爬虫架构</h2>
                                    <blockquote>
                                        <p>技术的本质就是<strong>结构与组合</strong>。今天在谈技术架构，有时候我们也会谈产品架构，再往前走，我们会谈商业架构，它中间都是一个结构的问题。</p>
                                    </blockquote>
                                    <h3 id="爬虫开发流程"><a href="#爬虫开发流程" class="headerlink" title="爬虫开发流程"></a>爬虫开发流程</h3>
                                    <p>在聊爬虫架构的时候，非常有必要将爬虫的流程梳理清楚。毕竟万变不离其宗，对于爬虫流程的掌握可以更好的理解、设计、组合爬虫， 爬虫基本步骤如下</p>
                                    <ol>
                                        <li>网络包捕获，确定URL</li>
                                        <li>模拟发送网络请求，获取响应</li>
                                        <li>解析响应， 获取数据</li>
                                        <li>解析数据，数据持久化</li>
                                    </ol>
                                    <h2 id="分布式爬虫架构"><a href="#分布式爬虫架构" class="headerlink" title="分布式爬虫架构"></a>分布式爬虫架构</h2>
                                    <h3 id="均衡分布式"><a href="#均衡分布式" class="headerlink" title="均衡分布式"></a>均衡分布式</h3>
                                    <h3 id="对等分布式"><a href="#对等分布式" class="headerlink" title="对等分布式"></a>对等分布式</h3>
                                    <h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2>
                                    <p>不要过度优化、不要过度预留扩展点、不要过度设计</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-07-13 15:10:13" itemprop="dateCreated datePublished" datetime="2022-07-13T15:10:13+08:00">2022-07-13</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>225</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/3870895095.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> go <i class="label-arrow"></i>
                                    </a>
                                    <a href="/3870895095.html" class="post-title-link" itemprop="url">go-concurrency</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Process-And-Thread"><a href="#Process-And-Thread" class="headerlink" title="Process And Thread"></a>Process And Thread</h2>
                                    <p>​ 操作系统会为应用程序创建一个进程, 作为应用程序. 它是一个为应用程序所有资源而运行的容器, 这些资源包含内存地址, 文件句柄, 设备和线程. 每个进程中都包含了一个主进程</p>
                                    <p>线程是操作系统调度的一种执行路径, 用于在处理器中执行我们编写的代码.</p>
                                    <p>一个进程从一个线程开始, 即主线程, 当该线程终止时，进程终止。这是因为主线程是应用程序的原点。然后，主线程可以依次启动更多的线程，而这些线程可以启动更多的线程。</p>
                                    <blockquote>
                                        <p>无论线程属于哪个进程，操作系统都会安排线程在可用处理器上运行。每个操作系统都有自己的算法来做出这些决定。</p>
                                    </blockquote>
                                    <h2 id="Goroutines-and-Parallelism"><a href="#Goroutines-and-Parallelism" class="headerlink" title="Goroutines and Parallelism"></a>Goroutines and Parallelism</h2>
                                    <p>Go 语言层面支持的 go 关键字，可以快速的让一个函数创建为 goroutine，我们可以认为 main 函数就是作为 goroutine 执行的。操作系统调度线程在可用处理器上运行，Go运行时调度 goroutine 在绑定到单个操作系统线程的逻辑处理器中运行（P）。即使使用这个单一的逻辑处理器和操作系统线程，也可以调度数十万 goroutine 以惊人的效率和性能并发运行。</p>
                                    <blockquote>
                                        <p> Concurrency is not Parallelism.</p>
                                    </blockquote>
                                    <p>​ 并发不是并行。并行是指两个或多个线程同时在不同的处理器执行代码。如果将运行时配置为使用多个逻辑处理器，则调度程序将在这些逻辑处理器之间分配 goroutine，这将导致 goroutine 在不同的操作系统线程上运行。但是，要获得真正的并行性，您需要在具有多个物理处理器的计算机上运行程序。否则，goroutine 将针对单个物理处理器并发运行，即使 Go 运行时使用多个逻辑处理器。</p>
                                    <p><strong>Keep yourself busy or do the work yourself</strong></p>
                                    <p><strong>Leave concurrency to the caller</strong></p>
                                    <p><strong>Never start a goroutine without knowning when it will stop</strong></p>
                                    <p>Any time you start a Goroutine you must ask yourself:</p>
                                    <ul>
                                        <li>
                                            <p>When will it terminate?</p>
                                        </li>
                                        <li>
                                            <p>What could prevent it from terminating?</p>
                                        </li>
                                    </ul>
                                    <p>小结: 由开发者管理goroutine的生命周期, 将并发性交给调用方</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-07-03 11:25:25" itemprop="dateCreated datePublished" datetime="2022-07-03T11:25:25+08:00">2022-07-03</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>922</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1752556181.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> go <i class="label-arrow"></i>
                                    </a>
                                    <a href="/1752556181.html" class="post-title-link" itemprop="url">go异常处理</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <p>在了解go异常处理的时候,有必要先了解为什么需要做异常处理,异常处理主要在哪几个方面,区分异常和错误的区别等等.</p>
                                    <h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2>
                                    <h3 id="为什么需要做异常处理"><a href="#为什么需要做异常处理" class="headerlink" title="为什么需要做异常处理?"></a>为什么需要做异常处理?</h3>
                                    <p>我个人认为有一下几点</p>
                                    <ol>
                                        <li>从程序设计的角度来看, 保证程序的鲁棒性,健壮性</li>
                                        <li>从开发的角度来看, 快速定位问题,解决问题,预防问题</li>
                                    </ol>
                                    <h3 id="异常处理主要在哪几个方面"><a href="#异常处理主要在哪几个方面" class="headerlink" title="异常处理主要在哪几个方面"></a>异常处理主要在哪几个方面</h3>
                                    <p>异常处理主要在实践上可以区分为 </p>
                                    <ul>
                                        <li>业务层面: 保证业务的稳定性, 逻辑性</li>
                                        <li>基础库: 保证代码逻辑正常</li>
                                    </ul>
                                    <h3 id="异常与错误的区别"><a href="#异常与错误的区别" class="headerlink" title="异常与错误的区别"></a>异常与错误的区别</h3>
                                    <p>编程语言中的异常和错误是两个相似但不相同的概念。异常和错误都可以引起程序执行错误而退出，他们属于程序没有考虑到的例外情况(exception)。</p>
                                    <p>便于理解举个例子: </p>
                                    <p>一个网络请求, 没有网络-错误</p>
                                    <p>一个网络请求过程中,对方服务器处理超时(注意是对方服务器正常) - 异常</p>
                                    <h2 id="Error-和-Exception"><a href="#Error-和-Exception" class="headerlink" title="Error 和 Exception"></a>Error 和 Exception</h2>
                                    <h3 id="go-error"><a href="#go-error" class="headerlink" title="go error"></a>go error</h3>
                                    <blockquote>
                                        <p> go error 就是一个普通的接口, 普通的值.</p>
                                    </blockquote>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// https://golang.org/pkg/builtin/#error</span></span><br><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error ()</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>经常使用 <code>errors.New()</code> 来返回一个 <code>error</code> 对象</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// https://go.dev/src/errors/errors.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> errors</span><br><span class="line"></span><br><span class="line"><span class="comment">// New returns an error that formats as the given text.</span></span><br><span class="line"><span class="comment">// Each call to New returns a distinct error value even if the text is identical.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;errorString&#123;text&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// errorString is a trivial implementation of error.</span></span><br><span class="line"><span class="keyword">type</span> errorString <span class="keyword">struct</span> &#123;</span><br><span class="line">	s <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *errorString)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> e.s</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <blockquote>
                                        <p>New() 返回的是 errorString对象的指针</p>
                                        <p>为什么返回的是指针?</p>
                                        <ul>
                                            <li>避免创建的error的值一致</li>
                                        </ul>
                                    </blockquote>
                                    <p>基础库中大量定义的error</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// https://go.dev/src/bufio/bufio.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	ErrInvalidUnreadByte = errors.New(<span class="string">"bufio: invalid use of UnreadByte"</span>)</span><br><span class="line">	ErrInvalidUnreadRune = errors.New(<span class="string">"bufio: invalid use of UnreadRune"</span>)</span><br><span class="line">	ErrBufferFull        = errors.New(<span class="string">"bufio: buffer full"</span>)</span><br><span class="line">	ErrNegativeCount     = errors.New(<span class="string">"bufio: negative count"</span>)</span><br><span class="line">)</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>tip: 在定义错误的时候带上包名,便于区分. 如<code>ErrInvalidUnreadByte = errors.New(&quot;bufio: invalid use of UnreadByte&quot;)</code> 中的<code>bufio:</code></p>
                                    <h3 id="Error-VS-Exception"><a href="#Error-VS-Exception" class="headerlink" title="Error VS Exception"></a>Error VS Exception</h3>
                                    <p>各语言的演进历史</p>
                                    <p>C: 但返回值, 入参通过传递指针作为入参, 返回int 表示成功还是失败, 以及如果失败的状态码是什么</p>
                                    <p>C++: 引入了Exception,但无法知道被调用者抛出什么异常</p>
                                    <p>Java: 引入了checked exception,方法的所有者必须申明, 调用者必须处理.</p>
                                    <p>go: 支持多参数返回, 所以很容易在函数签名上实现了error interface的对象,交由调用者处理</p>
                                    <blockquote>
                                        <p>如果一个函数返回了 <code>(value,error)</code>, 不能对这个<code>value</code>做任何假设, 必须先判定<code>error</code></p>
                                    </blockquote>
                                    <p> 补充: go中<code>panic</code>机制,意味着 fatal all, 不能假设调用者来解决<code>panic</code> 意味着代码down了</p>
                                    <p> <strong>记录单一清晰的错误, 并处理!!!</strong></p>
                                    <p>注意二值性</p>
                                    <h3 id="go特征"><a href="#go特征" class="headerlink" title="go特征"></a>go特征</h3>
                                    <ul>
                                        <li>简单</li>
                                        <li>考虑失败而不是成功</li>
                                        <li>没有隐藏的控制流</li>
                                        <li>完全交给开发者来处理</li>
                                        <li>
                                            <p><strong>Error are values</strong></p>
                                            <p>对于真正的错误, 表示不可恢复的程序错误,例如索引越界, 不可恢复的环境问题, 堆栈溢出,才使用<code>panic</code> ,对于其他的错误情况,应该是情况我使用error来进行判定 </p>
                                        </li>
                                    </ul>
                                    <h2 id="go-error-type"><a href="#go-error-type" class="headerlink" title="go error type"></a>go error type</h2>
                                    <h3 id="Sentinel-Error"><a href="#Sentinel-Error" class="headerlink" title="Sentinel Error"></a>Sentinel Error</h3>
                                    <p>预定义的特定错误,称之为 Sentinel Error. 这个名字起源于计算机编程中使用一个表示不可能进一步处理的做法. 使用特定值来表示错误.</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">if</span> err == ErrorSomething &#123; ....&#125;</span><br><span class="line"><span class="comment">// 类似于 io.EOF 更底层的syscall.ENOENT</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>使用 Sentinel Error 值是最不灵活的错误处理策略, 因为调用方法 必须使用<code>==</code></p>
                                    <p>将结果与预先声明的值进行比较. 当需要提供更多的上下文时,就会出现一个因为反返回一个不同的错误将被破坏相等性检查.</p>
                                    <p>例如一些有意义的<code>fmt.Errorf</code> 携带一些上下文,也会破坏调用者的<code>==</code> ,调用者将被迫查看<code>error.Error()</code>方法的输出,以查看它是否与特定的字符串匹配</p>
                                    <p><strong>tips:</strong></p>
                                    <ul>
                                        <li>不依赖检查<code>error.Error</code>的输出.</li>
                                    </ul>
                                    <blockquote>
                                        <p> 不应该以来检测<code>error.Error</code>的输出, Error方法存在于error接口主要用于方便开发者使用,而不是程序(编写测试会依赖这个返回). 这个输出的字符串用于记录日志,输出到stdout</p>
                                    </blockquote>
                                    <ul>
                                        <li>Sentient errors 成为你API公共部分</li>
                                    </ul>
                                    <blockquote>
                                        <p>如果公共函数或方法返回一个特定的值,那么该值必须是公共的,当然要有文档记录,这会增加API的表面积</p>
                                        <p>如果API定义了以恶搞返回特定错误的<code>Interface</code> ,则该接口的所有实现都将被限制为仅返回该错误, 即使他们可以提供更具有描述性错误</p>
                                        <p>比如: io.Reader. 像io.Copy这类函数需要reader的实现者比如返回 io.EOF 来告诉调用者没有更多数据量,但这又不是错误</p>
                                    </blockquote>
                                    <ul>
                                        <li>Sentient errors 在这个两个包之间创建依赖</li>
                                    </ul>
                                    <blockquote>
                                        <p>Sentinel errors 最糟糕的问题是他们在两个包之间创建了源码依赖关系</p>
                                        <p>例如检查错误是否等于io.EOF, 代码就必须要导入io包, 虽然听起来似乎不那么糟糕,但想象一下,当项目中的许多包到处错误值时,存在耦合,项目中的其他包必须要导入这些错误值才能校验特定的错误条件</p>
                                    </blockquote>
                                    <p><strong>建议:尽可能的避免使用 sentinel errors</strong></p>
                                    <h3 id="Error-Types"><a href="#Error-Types" class="headerlink" title="Error Types"></a>Error Types</h3>
                                    <p>Error type 实现了error接口自定义类型.例如<code>ExampleError</code> 类型记录了文件和行号以及展示发生了什么. 如下代码所示</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ExampleError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Msg      <span class="keyword">string</span></span><br><span class="line">	FileName <span class="keyword">string</span></span><br><span class="line">	Line     <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *ExampleError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">`%s:%d %s`</span>, e.FileName, e.Line, e.Msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;ExampleError&#123;<span class="string">`something happened`</span>, <span class="string">`example.go`</span>, <span class="number">33</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := test()</span><br><span class="line">	<span class="keyword">switch</span> err := err.(<span class="keyword">type</span>) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line">	<span class="comment">// call succeeded, nothing to do</span></span><br><span class="line">	<span class="keyword">case</span> *ExampleError:</span><br><span class="line">		fmt.Println(<span class="string">`Error occurred on call:`</span>, err)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="comment">// unknown error</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>与错误值相比, 错误类型的优点是他们能够包装底层错误以提供更多上下文.</p>
                                    <p>官方实例 os.PathError:</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">type</span> PathError <span class="keyword">struct</span> &#123;</span><br><span class="line">	Op      <span class="keyword">string</span></span><br><span class="line">	Path    <span class="keyword">string</span></span><br><span class="line">	Err     <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>调用者要使用类型断言和switch,就要让自定义的error变为公共的, 这种模型会导致和调用者产生强耦合,从而导致API非常脆弱</p>
                                    <p>结论: 尽量避免使用error types,或者说尽量避免其成为公共API的一部分</p>
                                    <p>虽然错误类型比sentinel error更完善,提供更多的上下文信息, 但error types 共享error value许多相同的问题.</p>
                                    <h3 id="Opaque-errors"><a href="#Opaque-errors" class="headerlink" title="Opaque errors"></a>Opaque errors</h3>
                                    <blockquote>
                                        <p> 不透明的错误处理</p>
                                    </blockquote>
                                    <p>直接返回错误而不假设其内容</p>
                                    <ul>
                                        <li>Assert errors for behaviour, not type</li>
                                    </ul>
                                    <blockquote>
                                        <p>在某些情况下,这种二分错误处理方法是不够的, 例如与外界交互(网络), 需要调用方法查错误的性质,以确定重试是否合理. 在这种情况下,可以使用断言错误实现了<strong>特定的行为</strong>.</p>
                                    </blockquote>
                                    <h2 id="Handle-Error"><a href="#Handle-Error" class="headerlink" title="Handle Error"></a>Handle Error</h2>
                                    <h3 id="Indented-flow-is-for-errors"><a href="#Indented-flow-is-for-errors" class="headerlink" title="Indented flow is for errors"></a>Indented flow is for errors</h3>
                                    <blockquote>
                                        <p>缩进流用于错误</p>
                                    </blockquote>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// 无错误的正常流程代码应为一条直线</span></span><br><span class="line">f, err := os.Open(filePath)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// do stuff</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="Eliminate-error-handing-by-eliminating-errors"><a href="#Eliminate-error-handing-by-eliminating-errors" class="headerlink" title="Eliminate error handing by eliminating errors"></a>Eliminate error handing by eliminating errors</h3>
                                    <blockquote>
                                        <p>通过消除错误来消除错误处理</p>
                                    </blockquote>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthenticateRequest</span><span class="params">(r *Requests)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    err := authenticate(r.user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthenticateRequest</span><span class="params">(r *Requests)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> authenticate(r.user)</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h4 id="io-Reader-Example"><a href="#io-Reader-Example" class="headerlink" title="io Reader Example"></a>io Reader Example</h4>
                                    <p><strong>统计 <code>io.Reader</code> 读取内容的行数代码实例</strong></p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CountLines</span><span class="params">(r io.Reader)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		br    = bufio.NewReader(r)</span><br><span class="line">		lines <span class="keyword">int</span></span><br><span class="line">		err   error</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		_, err := br.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">		lines++</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err != io.EOF &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> lines, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>改进-使用<code>bufio.scanner</code></p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CountLines1</span><span class="params">(r io.Reader)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> lines <span class="keyword">int</span></span><br><span class="line">	sc := bufio.NewScanner(r)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> sc.Scan() &#123;</span><br><span class="line">		lines++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> lines, sc.Err()</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h4 id="Http-Example"><a href="#Http-Example" class="headerlink" title="Http Example"></a>Http Example</h4>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">type</span> Header <span class="keyword">struct</span> &#123;</span><br><span class="line">	Key, Value <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Status <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code   <span class="keyword">int</span></span><br><span class="line">	Reason <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteResponse</span><span class="params">(w io.Writer, s Status, headers []Header, body io.Reader)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	_, err := fmt.Fprintf(w, <span class="string">"HTTP/1.1 %d %s\r\n"</span>, s.Code, s.Reason)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, h := <span class="keyword">range</span> headers &#123;</span><br><span class="line">		_, err := fmt.Fprintf(w, <span class="string">"%s:%s\r\n"</span>, h.Key, h.Value)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> _, err := fmt.Fprintf(w, <span class="string">"\r\n"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_, err = io.Copy(w, body)</span><br><span class="line">	<span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Header <span class="keyword">struct</span> &#123;</span><br><span class="line">	Key, Value <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Status <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code   <span class="keyword">int</span></span><br><span class="line">	Reason <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> errWrite <span class="keyword">struct</span> &#123;</span><br><span class="line">	io.Writer</span><br><span class="line">	err error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *errWrite)</span> <span class="title">Write</span><span class="params">(buf []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> n <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">if</span> e.err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	n, e.err = e.Writer.Write(buf)</span><br><span class="line">	<span class="keyword">return</span> n, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteResponse</span><span class="params">(w io.Writer, s Status, headers []Header, body io.Reader)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	ew := &amp;errWrite&#123;Writer: w&#125;</span><br><span class="line">	fmt.Fprintf(ew, <span class="string">"HTTP/1.1 %d %s\r\n"</span>, s.Code, s.Reason)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, h := <span class="keyword">range</span> headers &#123;</span><br><span class="line">		fmt.Fprintf(ew, <span class="string">"%s:%s\r\n"</span>, h.Key, h.Value)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Fprint(ew, <span class="string">"\r\n"</span>)</span><br><span class="line">	io.Copy(ew, body)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ew.err</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="Wrap-errors"><a href="#Wrap-errors" class="headerlink" title="Wrap errors"></a>Wrap errors</h3>
                                    <p>you should only handle errors once. Handing an error means inspecting the error value, and make a single decision</p>
                                    <p>日志与错误无关且对调试没有帮助的信息都应视为噪声, 应予以质疑. 记录的原因是应为某些东西失败了,而包含了答案</p>
                                    <ul>
                                        <li>错误要被日志记录</li>
                                        <li>应用程序处理错误,保证百分百完整性</li>
                                        <li>之后不在报当前错误</li>
                                    </ul>
                                    <p><a href="http://github.com/pkg/errors" target="_blank" rel="noopener">pkg-errors</a></p>
                                    <p><a href="https://pkg.go.dev/errors" target="_blank" rel="noopener">dev-pkg-errors</a></p>
                                    <h4 id="pkg-errors"><a href="#pkg-errors" class="headerlink" title="pkg-errors"></a>pkg-errors</h4>
                                    <ul>
                                        <li>在应用代码中,使用<code>pkg/errors</code>中的<code>errors.New</code> 或者 <code>error.Errorf</code>返回错误</li>
                                        <li>如果调用其他包内的函数,通常简单的直接返回</li>
                                        <li>如果与其他库协作, 考虑使用<code>pkg/errors</code>中的<code>errors.New</code> 或者 <code>error.Errorf</code>返回错误保持堆栈信息</li>
                                        <li>直接放回错误, 而不是每个错误产生的地方打日志</li>
                                        <li>在程序的顶部或者是工作的 goroutine顶部(请求入口), 使用<code>%+v</code>保存堆栈详情记录</li>
                                        <li>使用<code>errors.Cause</code>获取<code>root error</code> 在进行sentinel error判定</li>
                                    </ul>
                                    <p><strong>小结</strong></p>
                                    <p>Packages that are reusable across many projects only return root error values.</p>
                                    <blockquote>
                                        <p> 选择 wrap error 是只有 applications 可以选择应用的策略。具有最高可重用性的包只能返回根错误值。此机制与 Go 标准库中使用的相同<strong>（</strong>kit<em> </em>库的<em> </em>sql.ErrNoRows<strong>）</strong>。</p>
                                    </blockquote>
                                    <p>If the error is not going to be handled, wrap and return up the call stack.</p>
                                    <blockquote>
                                        <p>这是关于函数/方法调用返回的每个错误的基本问题。如果函数/方法不打算处理错误，那么用足够的上下文 wrap errors 并将其返回到调用堆栈中。例如，额外的上下文可以是使用的<strong>输入参数</strong>或失败的查询<strong>语句</strong>。确定您记录的上下文是足够多还是太多的一个好方法是检查日志并验证它们在开发期间是否为您工作。</p>
                                    </blockquote>
                                    <p>Once an error is handled, it is not allowed to be passed up the call stack any longer.</p>
                                    <blockquote>
                                        <p> <em>一旦确定函数/方法将处理错误，错误就不再是错误。如果函数/方法仍然需要发出返回，则它不能返回错误值。它应该只返回零**（比如降级处理中，你返回了降级数据，然后需要</em> <em>return nil<strong>）</strong>。</em></p>
                                    </blockquote>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-07-01 13:02:22" itemprop="dateCreated datePublished" datetime="2022-07-01T13:02:22+08:00">2022-07-01</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>3.4k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>3 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/4274624780.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> 爬虫 <i class="label-arrow"></i>
                                    </a>
                                    <a href="/4274624780.html" class="post-title-link" itemprop="url">爬虫对抗相关总结</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <p>又双叒叕 一篇相关于爬虫对抗的总结. 一般来说对于爬虫的对抗主要体现在如下几个方面</p>
                                    <ul>
                                        <li>
                                            <p>反调: 反抓包\反调试\代码混淆与防护</p>
                                        </li>
                                        <li>
                                            <p>反(欺诈)模拟: 网络协议校验\TLS\请求头(字段\字段顺序\反盗链)校验</p>
                                        </li>
                                        <li>
                                            <p>数据防护\验证码\风控对抗等</p>
                                        </li>
                                    </ul>
                                    <p>反爬虫(风险策略)工程师预防以及防止爬虫工程师对数据的抓取, 一方要”守”一方要”攻”,各为其主各司其职你来我往谁也多呈不让.</p>
                                    <h2 id="反抓包"><a href="#反抓包" class="headerlink" title="反抓包"></a>反抓包</h2>
                                    <p>反抓包的目的多种多样,简而言之便是让爬虫工作者无法捕获网络数据包</p>
                                    <p>如: 不走http\不走代理\请求分离\SSLping单(双)向校验\网络协议定制等</p>
                                    <h2 id="反调试"><a href="#反调试" class="headerlink" title="反调试"></a>反调试</h2>
                                    <p>反调试的策略诸多, 主要体现方面有思路为 预防调试\ 阻断调试\ 破坏调试,让爬虫逆向者无法有效进行调试</p>
                                    <h3 id="预防调试"><a href="#预防调试" class="headerlink" title="预防调试"></a>预防调试</h3>
                                    <p>预防调试的手段也多种多样, 简而言之便是预防开发者调试从而阻断分析无法进入下一步,主要体现在环境检测\动态代码</p>
                                    <p>譬如:</p>
                                    <ul>
                                        <li>web端: 控制台检测\动态js\wasm\代码防护与混淆\hook检测\堆栈顺序检测</li>
                                        <li>
                                            <p>Android: 运行环境检测(root\签名校验\hook检测\模拟器检测)\进程检测与调试工具检检测(jadx\apktool\jeb\xposed\frida\ida)\壳\so\</p>
                                        </li>
                                        <li>
                                            <p>web:</p>
                                            <ul>
                                                <li>分辨率检测</li>
                                                <li>控制台检测</li>
                                                <li>动态js</li>
                                                <li>wasm</li>
                                            </ul>
                                        </li>
                                        <li>
                                            <p>Android:</p>
                                            <ul>
                                                <li>运行环境检测<ul>
                                                        <li>root检测</li>
                                                        <li>设备检测</li>
                                                        <li>签名校验</li>
                                                    </ul>
                                                </li>
                                                <li>调试器工具检查<ul>
                                                        <li>工具特性检测<ul>
                                                                <li>jadx</li>
                                                                <li>apktool</li>
                                                                <li>jeb</li>
                                                                <li>xposed</li>
                                                                <li>frida</li>
                                                                <li>ida</li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </li>
                                                <li>代码防护<ul>
                                                        <li>壳</li>
                                                        <li>so</li>
                                                        <li>代码隐写</li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                        <li>代码混淆<ul>
                                                <li>布局混淆</li>
                                                <li>数据混淆</li>
                                                <li>数字混淆</li>
                                                <li>字符串混淆</li>
                                                <li>控制流平坦化</li>
                                            </ul>
                                        </li>
                                    </ul>
                                    <h3 id="阻断调试"><a href="#阻断调试" class="headerlink" title="阻断调试"></a>阻断调试</h3>
                                    <p>阻断调试, 顾名思义便是阻止调试.或着说将你引入错误的逻辑中,无法正常的调试</p>
                                    <p>譬如代码中的环境检测\设备指纹</p>
                                    <h3 id="破坏调试"><a href="#破坏调试" class="headerlink" title="破坏调试"></a>破坏调试</h3>
                                    <p>相对于阻断调试更加极端的手段，一方面对调试者信息进行采集、攻击调试者。例如删除文件、重置电脑、甚至释放病毒等</p>
                                    <p><strong>小结</strong></p>
                                    <p>做反调试主要有两个方面一方面是特征区分预防\阻断\破坏调试, 另一方面是对代码进行保护与混淆</p>
                                    <h2 id="反-欺诈-模拟"><a href="#反-欺诈-模拟" class="headerlink" title="反(欺诈)模拟"></a>反(欺诈)模拟</h2>
                                    <p>如果说反调试是为了防止逆向工作者,那么反模拟便是针对爬虫工程师.</p>
                                    <p>简而言之,防止模拟请求. 那么对于此.我们只需要区分开这个请求, 亦或者将结果数据进行处理这样就可以让开发者无法拿到正常有价值的数据,从而实现反爬虫的效果.</p>
                                    <blockquote>
                                        <p>因为我们知道爬虫简单来说就是模拟用户请求的代码实现</p>
                                    </blockquote>
                                    <p>反模拟主要在对于爬虫的请求进行甄别,常见的关键点有</p>
                                    <p>请求库特征,譬如tls指纹</p>
                                    <p>请求协议的区分: 譬如强制指定http2或quic等\使用自研的协议</p>
                                    <p>参数校验: 校验的思路有 参数字段的校验如cookie等, 参数顺序的校验</p>
                                    <p>加密与编码算法的定制修改,</p>
                                    <ul>
                                        <li>位运算\ 在特殊的头\尾部加入字符</li>
                                        <li>魔改hash算法\base(16\32\64)等</li>
                                        <li>对称加密与非对称加密算法</li>
                                    </ul>
                                    <blockquote>
                                        <p>校验的字段通常使用到加密算法或编码算法</p>
                                    </blockquote>
                                    <h2 id="数据防护"><a href="#数据防护" class="headerlink" title="数据防护"></a>数据防护</h2>
                                    <p>当我们完成了以上的种种, 便将”战场”迁移到最后的数据保护上,</p>
                                    <p>常见的方式有数据加密(从服务端返回的数据进行加密或编码)</p>
                                    <p>数据隐写</p>
                                    <blockquote>
                                        <p>无法轻松直接的从返回的数据包中获取到数据, 只需要保证界面展示上正常的即可</p>
                                    </blockquote>
                                    <h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2>
                                    <p>验证码不必多说, 譬如常见的如下几种类型</p>
                                    <ul>
                                        <li>滑动型</li>
                                        <li>计算型</li>
                                        <li>点选型(图像: 一维\二维\三维)</li>
                                        <li>短信或语音验证型</li>
                                    </ul>
                                    <p>通常验证码还会对对应的譬如图片进行安全处理, 如图片重排\模糊化等等干扰识别以及防止图像被还原</p>
                                    <p>还有就是检测运行环境</p>
                                    <h2 id="风控"><a href="#风控" class="headerlink" title="风控"></a>风控</h2>
                                    <h3 id="IP风控"><a href="#IP风控" class="headerlink" title="IP风控"></a>IP风控</h3>
                                    <h3 id="设备风控"><a href="#设备风控" class="headerlink" title="设备风控"></a>设备风控</h3>
                                    <h3 id="账号风控"><a href="#账号风控" class="headerlink" title="账号风控"></a>账号风控</h3>
                                    <p>风控其核心的对抗 个人认为有两点</p>
                                    <ol>
                                        <li>特征</li>
                                        <li>逻辑</li>
                                    </ol>
                                    <p>写的比较散,但实现起来却并不是唯一, 仅按个人认为的进行的区分, 大多情况都不可能单独出现.</p>
                                    <h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2>
                                    <p>无论是爬虫工程师还是反爬虫亦或者风险策略工程师. 攻与守并非是一成不变的. ,掌握底层逻辑,不断的成长向上吧. 瑞斯拜~</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-28 19:13:41" itemprop="dateCreated datePublished" datetime="2022-06-28T19:13:41+08:00">2022-06-28</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.5k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/4038451747.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> frida <i class="label-arrow"></i>
                                    </a>
                                    <a href="/4038451747.html" class="post-title-link" itemprop="url">frida-rpc</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="frida-主动调用"><a href="#frida-主动调用" class="headerlink" title="frida 主动调用"></a>frida 主动调用</h2>
                                    <p>主动调用: 强制去调用函数执行</p>
                                    <p>被动调用: 由app主导,按照正常的执行顺序执行函数. 函数执行完全依靠与用户交互完成从而间接的调用到关键函数</p>
                                    <p>在Java中,类的函数可以分为两种: 类函数与实例方法, 也可以称之为静态方法和动态方法.</p>
                                    <p>类函数使用关键字<code>static</code> 修饰,与对应的类绑定, 当然如果该类函数还被<code>public</code> 修饰,则在外部就可以直接通过类去调用</p>
                                    <p>实例方法没有被 <code>staic</code> 修饰,在外部只能通过实例化对应的类,在通过该实例调用对应的方法.</p>
                                    <p>在frida中主动调用的类型会根据方法的类型区分开来, 类函数的直接调用使用<code>Java.use</code> 即可,实例方法则需要先找到对应的实例后对方法进行调用, 通常使用<code>Java.choose</code>.</p>
                                    <p>示例代码如下</p>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Script loaded successfully, start hook...'</span>);</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Inside java perform function...'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 静态(类)函数 主动调用</span></span><br><span class="line">        <span class="keyword">let</span> class_name = Java.use(<span class="string">'com.xxx.xxx.xxx'</span>);</span><br><span class="line">        <span class="keyword">let</span> result1 = class_name.method();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态(实例)方法 主动调用</span></span><br><span class="line">        Java.choose(<span class="string">'com.xxx.xxx.xxx'</span>, &#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'instance found '</span>, instance);</span><br><span class="line">                <span class="keyword">let</span> result2 = instance.method();</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'search complete'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="frida-rpc"><a href="#frida-rpc" class="headerlink" title="frida-rpc"></a>frida-rpc</h2>
                                    <p>通过exports 将结果导出,以便于python 结合frida模块直接调用.</p>
                                    <p>js脚本与hook脚本写法基本一致,示例代码如下所示</p>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// rpc.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Script loaded successfully, start hook...'</span>);</span><br><span class="line">    <span class="keyword">var</span> xxx_result = <span class="string">''</span>;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Inside java perform function...'</span>);</span><br><span class="line">        <span class="keyword">var</span> class_name = Java.use(<span class="string">'com.xxx.xxx.xxx'</span>);</span><br><span class="line">        xxx_result = class_name.method_name(<span class="string">'参数'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> xxx_result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Script loaded successfully, start hook...'</span>);</span><br><span class="line">    <span class="keyword">var</span> xxx_result = <span class="string">''</span>;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Inside java perform function...'</span>);</span><br><span class="line">        Java.choose(<span class="string">'com.xxx.xxx'</span>, &#123;</span><br><span class="line">            onMatch: <span class="function"><span class="keyword">function</span> (<span class="params">instance</span>) </span>&#123;</span><br><span class="line">                xxx_result = class_name.method_name(<span class="string">'参数'</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'search complete'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> xxx_result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.exports = &#123;</span><br><span class="line">    rpc_func1: func1,</span><br><span class="line">    rpc_func2: func2</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <figure class="highlight python">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment"># rpc.py</span></span><br><span class="line"><span class="comment"># File: proc.py</span></span><br><span class="line"><span class="comment"># User: Payne-Wu</span></span><br><span class="line"><span class="comment"># Date: 2022/6/26 17:33</span></span><br><span class="line"><span class="comment"># Desc:</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">script_path = <span class="string">"HookScript/example.js"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message_call_back</span><span class="params">(message, data)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    message call back</span></span><br><span class="line"><span class="string">    :param message:</span></span><br><span class="line"><span class="string">    :param data:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    logger.info(message)</span><br><span class="line">    logger.info(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attach_hook</span><span class="params">(app_name)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param app_name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    process = device.attach(app_name)</span><br><span class="line">    <span class="keyword">with</span> open(script_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        script = process.create_script(f.read())</span><br><span class="line">    script.on(<span class="string">'message'</span>, message_call_back)</span><br><span class="line">    script.load()</span><br><span class="line">    sys.stdin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spawn</span><span class="params">(package_name)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    :param package_name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    pid = device.spawn(package_name)</span><br><span class="line">    process = device.attach(pid)</span><br><span class="line">    <span class="keyword">with</span> open(script_path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        script = process.create_script(f.read())</span><br><span class="line">    script.on(<span class="string">'message'</span>, message_call_back)</span><br><span class="line">    script.load()</span><br><span class="line">    <span class="comment"># rpc </span></span><br><span class="line">    <span class="comment"># script.exports.func_name</span></span><br><span class="line">    device.resume(pid)</span><br><span class="line">    sys.stdin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    spawn(<span class="string">'com.xxx.xxx'</span>)</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-26 14:40:16" itemprop="dateCreated datePublished" datetime="2022-06-26T14:40:16+08:00">2022-06-26</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>389</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/2947499305.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> smali <i class="label-arrow"></i>
                                    </a>
                                    <a href="/2947499305.html" class="post-title-link" itemprop="url">smali语法</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Smali"><a href="#Smali" class="headerlink" title="Smali"></a>Smali</h2>
                                    <p><strong>Smali是Android虚拟机的反汇编语言</strong></p>
                                    <p>Android代码一般是用JVM语言编写，执行Androdi程序一般需要用到JVM，在Android平台上也不例外，但是出于性能上的考虑，并没有使用标准的JVM，而是使用专门的Android虚拟机（5.0以下为Dalvik，5.0以上为ART）。Android虚拟机的可执行文件并不是普通的class文件，而是再重新整合打包后生成的dex文件。smali是dex格式的文件的汇编器<br>反汇编器\ 其语法是一种宽松的jasmin/dedexer 语法,实现了.dex格式的所有功能(注解/调试信息/线路信息等)</p>
                                    <h2 id="学习smali必要性"><a href="#学习smali必要性" class="headerlink" title="学习smali必要性"></a>学习smali必要性</h2>
                                    <ol>
                                        <li>动态调试与修改APK, 当静态分析已经无法满足时,此时便需要对Android进行动态调试, 而动态调试便是调试smail</li>
                                        <li>修改APK运行逻辑, 通过修改smali代码,在重新打包.便可对app进行持久化的修改.(常用的注入均在外部而不是app内部)</li>
                                    </ol>
                                    <blockquote>
                                        <p>插件: java2smail</p>
                                    </blockquote>
                                    <h2 id="Smali基本语法"><a href="#Smali基本语法" class="headerlink" title="Smali基本语法"></a>Smali基本语法</h2>
                                    <h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3>
                                    <p><strong>关键字</strong></p>
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>关键字</th>
                                                    <th>说明</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>.class</td>
                                                    <td>定义类名</td>
                                                </tr>
                                                <tr>
                                                    <td>.super</td>
                                                    <td>定义父类名</td>
                                                </tr>
                                                <tr>
                                                    <td>.source</td>
                                                    <td>定义源文件名</td>
                                                </tr>
                                                <tr>
                                                    <td>.filed</td>
                                                    <td>定义字段</td>
                                                </tr>
                                                <tr>
                                                    <td>.method</td>
                                                    <td>定义方法开始</td>
                                                </tr>
                                                <tr>
                                                    <td>.end method</td>
                                                    <td>定义方法结束</td>
                                                </tr>
                                                <tr>
                                                    <td>.annotation</td>
                                                    <td>定义注解开始</td>
                                                </tr>
                                                <tr>
                                                    <td>.end annotation</td>
                                                    <td>定义注解结束</td>
                                                </tr>
                                                <tr>
                                                    <td>.implements</td>
                                                    <td>定义接口指令</td>
                                                </tr>
                                                <tr>
                                                    <td>.local</td>
                                                    <td>指定了方法内局部变量的个数</td>
                                                </tr>
                                                <tr>
                                                    <td>.registers</td>
                                                    <td>指定方法内使用寄存器的总数</td>
                                                </tr>
                                                <tr>
                                                    <td>.prologue</td>
                                                    <td>表示方法中代码的开始处</td>
                                                </tr>
                                                <tr>
                                                    <td>.line</td>
                                                    <td>表示java源文件中指定行</td>
                                                </tr>
                                                <tr>
                                                    <td>.paramter</td>
                                                    <td>指定方法的参数</td>
                                                </tr>
                                                <tr>
                                                    <td>.param</td>
                                                    <td>和.paramter含义一致,但是表达格式不同</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3>
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Smali</th>
                                                    <th>Java</th>
                                                    <th>备注</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>v</td>
                                                    <td>void</td>
                                                    <td>只能用于返回值类型</td>
                                                </tr>
                                                <tr>
                                                    <td>Z</td>
                                                    <td>boolean</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>B</td>
                                                    <td>byte</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>S</td>
                                                    <td>short</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>C</td>
                                                    <td>char</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>I</td>
                                                    <td>int</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>J</td>
                                                    <td>long</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>F</td>
                                                    <td>float</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>D</td>
                                                    <td>double</td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <td>Lpackage/name;</td>
                                                    <td>对象类型</td>
                                                    <td>L表示这是一个对象类型，package表示该对象所在的包，；表示对象名称的结束</td>
                                                </tr>
                                                <tr>
                                                    <td>[类型</td>
                                                    <td>数组</td>
                                                    <td>[I表示一个int型数据，[Ljava/lang/String 表示一个String的对象数组</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p><strong>类声明</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="class">.<span class="keyword">class</span> + 修饰符 + 类名</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>构造函数</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">.method 权限修饰符 constructor &lt;init&gt;(参数类型) V</span><br><span class="line"># 方法体</span><br><span class="line">.end method</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>成员变量定义格式</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">.field <span class="keyword">public</span>/<span class="keyword">private</span> [<span class="keyword">static</span>][<span class="keyword">final</span>] varName:&lt;类型&gt;</span><br><span class="line">.field 访问权限修饰符 类型修饰符 变量名:类名路径</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>返回值关键字</strong></p>
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>返回关键字</th>
                                                    <th>Java数据类型</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>return</td>
                                                    <td>byte short float char boolean</td>
                                                </tr>
                                                <tr>
                                                    <td>return-void</td>
                                                    <td>void</td>
                                                </tr>
                                                <tr>
                                                    <td>return-wide</td>
                                                    <td>long double</td>
                                                </tr>
                                                <tr>
                                                    <td>return-object</td>
                                                    <td>数组 object</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p><strong>获取指令</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">iget, sget, iget-<span class="keyword">boolean</span>, sget-<span class="keyword">boolean</span>, iget-object, sget-object</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>操作指令</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">iput, sput, iput-<span class="keyword">boolean</span>, sput-<span class="keyword">boolean</span>, iput-object, sput-object</span><br><span class="line">array的操作是aget和aput</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>指令解析</strong></p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">sget-object v0,Lcom/aaa;-&gt;ID:Ljava/lang/String;</span><br><span class="line">获取ID这个String类型的成员变量并放到v0这个寄存器中</span><br><span class="line">iget-object v0,p0,Lcom/aaa;-&gt;view:Lcom/aaa/view;</span><br><span class="line">iget-object比sget-object多一个参数p0，这个参数代表变量所在类的实例。这里p0就是<span class="keyword">this</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>example</p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// example 1 相当于java代码：this.timer = null;</span></span><br><span class="line"><span class="keyword">const</span>/<span class="number">4</span> v3, <span class="number">0x0</span></span><br><span class="line">sput-object v3, Lcom/aaa;-&gt;timer:Lcom/aaa/timer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// example 2</span></span><br><span class="line">.local v0, args:Landroid/os/Message;</span><br><span class="line"><span class="keyword">const</span>/<span class="number">4</span> v1, <span class="number">0x12</span></span><br><span class="line">iput v1,v0,Landroid/os/Message;-&gt;what:I</span><br><span class="line"><span class="comment">// 相当于java代码：args.what = 18; 其中args为Message的实例</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p><strong>调用指令</strong></p>
                                    <div class="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>调用关键字</th>
                                                    <th>作用</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>invoke-virtual</td>
                                                    <td>非私有实例方法调用</td>
                                                </tr>
                                                <tr>
                                                    <td>invoke-direct</td>
                                                    <td>构造方法以及私有方法的调用</td>
                                                </tr>
                                                <tr>
                                                    <td>invoke-static</td>
                                                    <td>静态方法的调用</td>
                                                </tr>
                                                <tr>
                                                    <td>invoke-super</td>
                                                    <td>父类方法的调用</td>
                                                </tr>
                                                <tr>
                                                    <td>invoke-interface</td>
                                                    <td>接口方法调用</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <p>调用格式： invoke-指令类型 {参数1, 参数2,…}, L类名;-&gt;方法名 如果不是是静态方法，参数1代表调用该方法的实例。</p>
                                    <h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2>
                                    <p>Java中变量都是存放在内存中的，Android为了提高性能，变量都是存放在寄存器中的，寄存器为32位，可以支持任何类型。64位类型(Long/ Double) 用2个格式的寄存器表示; Dalvik字节码有两种类型: 原始类型和引用类型(<br>包括对象和数组)</p>
                                    <p>寄存器分为如下两类： 1、本地寄存器: 用v开头数字结尾的符号来表示，v0, v1, v2,… 2、参数寄存器: 用p开头数字结尾的符号来表示，p0,p1,p2,…<br><em>注意：</em><br><strong>在非static方法中，p0代指this，p1为方法的第一个参数。</strong><br><strong>在static方法中，p0为方法的第一个参数。</strong></p>
                                    <figure class="highlight smali">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">const/4 v0, 0x1 //把值0x1存到v0本地寄存器</span><br><span class="line">iput-boolean v0,p0,<span class="class">Lcom/aaa;</span>-&gt;IsRegisterd:Z //把v0中的值赋给com.aaa.IsRegistered，p0代表this，相当于this.Isregistered=true</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="tip"><a href="#tip" class="headerlink" title="tip:"></a>tip:</h2>
                                    <p>查看smali代码时可以和java代码结合来看</p>
                                    <h2 id="referer"><a href="#referer" class="headerlink" title="referer"></a>referer</h2>
                                    <p><a href="https://source.android.com/devices/tech/dalvik/dalvik-bytecode" target="_blank" rel="noopener">Dalvik 字节码</a></p>
                                    <p><a href="https://www.jianshu.com/p/9931a1e77066" target="_blank" rel="noopener">https://www.jianshu.com/p/9931a1e77066</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-25 08:54:51" itemprop="dateCreated datePublished" datetime="2022-06-25T08:54:51+08:00">2022-06-25</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.5k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/3591261126.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> frida <i class="label-arrow"></i>
                                    </a>
                                    <a href="/3591261126.html" class="post-title-link" itemprop="url">frida hook</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="frida启动方式"><a href="#frida启动方式" class="headerlink" title="frida启动方式"></a>frida启动方式</h2>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment"># frida -h</span></span><br><span class="line">usage: frida [options] target</span><br><span class="line"></span><br><span class="line">positional arguments:</span><br><span class="line">  args                  extra arguments and/or target</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --<span class="built_in">help</span>            show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">  -D ID, --device ID    connect to device with the given ID</span><br><span class="line">  -U, --usb             connect to USB device</span><br><span class="line">  -R, --remote          connect to remote frida-server</span><br><span class="line">  -H HOST, --host HOST  connect to remote frida-server on HOST</span><br><span class="line">  --certificate CERTIFICATE</span><br><span class="line">                        speak TLS with HOST, expecting CERTIFICATE</span><br><span class="line">  --origin ORIGIN       connect to remote server with “Origin” header <span class="built_in">set</span> to ORIGIN</span><br><span class="line">  --token TOKEN         authenticate with HOST using TOKEN</span><br><span class="line">  --keepalive-interval INTERVAL</span><br><span class="line">                        <span class="built_in">set</span> keepalive interval <span class="keyword">in</span> seconds, or 0 to <span class="built_in">disable</span> (defaults to -1 to auto-select based on transport)</span><br><span class="line">  --p2p                 establish a peer-to-peer connection with target</span><br><span class="line">  --stun-server ADDRESS</span><br><span class="line">                        <span class="built_in">set</span> STUN server ADDRESS to use with --p2p</span><br><span class="line">  --relay address,username,password,turn-&#123;udp,tcp,tls&#125;</span><br><span class="line">                        add relay to use with --p2p</span><br><span class="line">  -f TARGET, --file TARGET</span><br><span class="line">                        spawn FILE</span><br><span class="line">  -F, --attach-frontmost</span><br><span class="line">                        attach to frontmost application</span><br><span class="line">  -n NAME, --attach-name NAME</span><br><span class="line">                        attach to NAME</span><br><span class="line">  -p PID, --attach-pid PID</span><br><span class="line">                        attach to PID</span><br><span class="line">  -W PATTERN, --await PATTERN</span><br><span class="line">                        await spawn matching PATTERN</span><br><span class="line">  --stdio &#123;inherit,pipe&#125;</span><br><span class="line">                        stdio behavior when spawning (defaults to “inherit”)</span><br><span class="line">  --aux option          <span class="built_in">set</span> aux option when spawning, such as “uid=(int)42” (supported types are: string, bool, int)</span><br><span class="line">  --realm &#123;native,emulated&#125;</span><br><span class="line">                        realm to attach <span class="keyword">in</span></span><br><span class="line">  --runtime &#123;qjs,v8&#125;    script runtime to use</span><br><span class="line">  --debug               <span class="built_in">enable</span> the Node.js compatible script debugger</span><br><span class="line">  --squelch-crash       <span class="keyword">if</span> enabled, will not dump crash report to console</span><br><span class="line">  -O FILE, --options-file FILE</span><br><span class="line">                        text file containing additional <span class="built_in">command</span> line options</span><br><span class="line">  --version             show program<span class="string">'s version number and exit</span></span><br><span class="line"><span class="string">  -l SCRIPT, --load SCRIPT</span></span><br><span class="line"><span class="string">                        load SCRIPT</span></span><br><span class="line"><span class="string">  -P PARAMETERS_JSON, --parameters PARAMETERS_JSON</span></span><br><span class="line"><span class="string">                        parameters as JSON, same as Gadget</span></span><br><span class="line"><span class="string">  -C USER_CMODULE, --cmodule USER_CMODULE</span></span><br><span class="line"><span class="string">                        load CMODULE</span></span><br><span class="line"><span class="string">  --toolchain &#123;any,internal,external&#125;</span></span><br><span class="line"><span class="string">                        CModule toolchain to use when compiling from source code</span></span><br><span class="line"><span class="string">  -c CODESHARE_URI, --codeshare CODESHARE_URI</span></span><br><span class="line"><span class="string">                        load CODESHARE_URI</span></span><br><span class="line"><span class="string">  -e CODE, --eval CODE  evaluate CODE</span></span><br><span class="line"><span class="string">  -q                    quiet mode (no prompt) and quit after -l and -e</span></span><br><span class="line"><span class="string">  -t TIMEOUT, --timeout TIMEOUT</span></span><br><span class="line"><span class="string">                        seconds to wait before terminating in quiet mode</span></span><br><span class="line"><span class="string">  --no-pause            automatically start main thread after startup</span></span><br><span class="line"><span class="string">  -o LOGFILE, --output LOGFILE</span></span><br><span class="line"><span class="string">                        output to log file</span></span><br><span class="line"><span class="string">  --eternalize          eternalize the script before exit</span></span><br><span class="line"><span class="string">  --exit-on-error       exit with code 1 after encountering any exception in the SCRIPT</span></span><br><span class="line"><span class="string">  --auto-perform        wrap entered code with Java.perform</span></span><br><span class="line"><span class="string">  --auto-reload         Enable auto reload of provided scripts and c module (on by default, will be required in the future)</span></span><br><span class="line"><span class="string">  --no-auto-reload      Disable auto reload of provided scripts and c module</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="Injection"><a href="#Injection" class="headerlink" title="Injection"></a>Injection</h2>
                                    <blockquote>
                                        <p>attach hook: 这种模式建立在app已经启动的情况下，frida利用ptrace的原理注入app进而完成Hook<br>spawn hook： 将app启动权限交与frida 来控制。使用spawn实现hook时会由frida将app重启在进行hook<br>注意：由于attach hook 基于ptrace原理进行完成，因此无法在IDA正在调试的目标app以attach注入进程中，当然若先用frida attach注入<br>在使用IDA进行调试则正常</p>
                                    </blockquote>
                                    <h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3>
                                    <h4 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h4>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">frida -Ul script_hook.js [-n] app_name</span><br><span class="line">frida -Ul script_hook.js -p pid</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h4 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h4>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">frida -Ul script_hook.js -f Identifier(package name) --no-pause</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="Python-script"><a href="#Python-script" class="headerlink" title="Python script"></a>Python script</h3>
                                    <figure class="highlight python">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> pptrint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">message_callback</span><span class="params">(message, data)</span>:</span></span><br><span class="line">    logger.info(<span class="string">f"[*] <span class="subst">&#123;message&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">device = frida.get_use_device(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># attach</span></span><br><span class="line">process = device.attach(<span class="string">'className'</span>)</span><br><span class="line">script = process.create_script(<span class="string">'hook_script'</span>)</span><br><span class="line">script.on(<span class="string">'message'</span>, message_callback)</span><br><span class="line">script.load()</span><br><span class="line">sys.stdin.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># spawn</span></span><br><span class="line">device = frida.get_use_device(<span class="number">-1</span>)</span><br><span class="line">pid = devices.spawn([<span class="string">'packageName'</span>])</span><br><span class="line">process = device.attach(pid)</span><br><span class="line">script = process.create_script(<span class="string">'hook_script'</span>)</span><br><span class="line">script.on(<span class="string">'message'</span>, message_callback)</span><br><span class="line">script.load()</span><br><span class="line">sys.stdin.read()</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="frida-api"><a href="#frida-api" class="headerlink" title="frida api"></a>frida api</h2>
                                    <p>JavaScript-api : <a href="https://frida.re/docs/javascript-api" target="_blank" rel="noopener">https://frida.re/docs/javascript-api</a></p>
                                    <p>JavaScript-api-java: <a href="https://frida.re/docs/javascript-api/#java" target="_blank" rel="noopener">https://frida.re/docs/javascript-api/#java</a></p>
                                    <p>JavaScript-api-module: <a href="https://frida.re/docs/javascript-api/#module" target="_blank" rel="noopener">https://frida.re/docs/javascript-api/#module</a></p>
                                    <h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="comment">// hook script</span></span><br><span class="line">&#125;);</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="Hook-类方法"><a href="#Hook-类方法" class="headerlink" title="Hook 类方法"></a>Hook 类方法</h3>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="comment">// hook class script</span></span><br><span class="line">    <span class="keyword">let</span> class_name = Java.use(<span class="string">'com.xxx.xxx.class_name'</span>);</span><br><span class="line">    class_name.method.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="comment">// this.xx</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <blockquote>
                                        <p>this.成员变量名.value</p>
                                    </blockquote>
                                    <h3 id="Hook-内部-匿名-类方法"><a href="#Hook-内部-匿名-类方法" class="headerlink" title="Hook 内部(匿名)类方法"></a>Hook 内部(匿名)类方法</h3>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="comment">// hook class script</span></span><br><span class="line">    <span class="comment">// 类路径$内部类名 在smail找</span></span><br><span class="line">    <span class="keyword">let</span> class_name = Java.use(<span class="string">'com.xxx.xxx.class_name$xx'</span>);</span><br><span class="line">    class_name.method.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="comment">// this.xx</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <blockquote>
                                        <p>从匿名类/内部类访问外部类的属性写法： this.this$0.value.外部类的属性名.value</p>
                                    </blockquote>
                                    <h2 id="Hook-重载方法"><a href="#Hook-重载方法" class="headerlink" title="Hook 重载方法"></a>Hook 重载方法</h2>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="comment">// hook class script</span></span><br><span class="line">    <span class="comment">// 类路径$内部类名 在smail找</span></span><br><span class="line">    <span class="keyword">let</span> class_name = Java.use(<span class="string">'com.xxx.xxx.class_name'</span>);</span><br><span class="line">    class_name.method.overload(参数<span class="number">1</span>, 参数<span class="number">2</span></span><br><span class="line">...).</span><br><span class="line">    implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="comment">// this.xx</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// overload(参数1，参数2...) 可以根据报错来确定</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="Hook-构造方法"><a href="#Hook-构造方法" class="headerlink" title="Hook 构造方法"></a>Hook 构造方法</h2>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="comment">// hook class script</span></span><br><span class="line">    <span class="comment">// 类路径$内部类名 在smail找</span></span><br><span class="line">    <span class="keyword">let</span> class_name = Java.use(<span class="string">'com.xxx.xxx.class_name'</span>);</span><br><span class="line">    class_name.$init().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="comment">// this.xx</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="Hook-实例"><a href="#Hook-实例" class="headerlink" title="Hook 实例"></a>Hook 实例</h2>
                                    <figure class="highlight js">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">Java.perfrom(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'script successfully loaded, start hook...'</span>);</span><br><span class="line">    <span class="keyword">let</span> variable = Java.use(<span class="string">'com.xxx.xxx.class_name'</span>).$<span class="keyword">new</span>(参数);</span><br><span class="line">&#125;);</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-18 21:17:21" itemprop="dateCreated datePublished" datetime="2022-06-18T21:17:21+08:00">2022-06-18</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>559</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/66759343.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> 工作 <i class="label-arrow"></i>
                                    </a>
                                    <a href="/66759343.html" class="post-title-link" itemprop="url">一些工作上的思考</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2>
                                    <p><strong>规范的</strong> 、<strong>结构的</strong>构造端到端</p>
                                    <h2 id="计算机"><a href="#计算机" class="headerlink" title="计算机"></a>计算机</h2>
                                    <p><a href="https://baijiahao.baidu.com/s?id=1698354809650781358" target="_blank" rel="noopener">《我对计算的理解· 吴瀚清》</a></p>
                                    <p>技术的本质就是<strong>结构与组合</strong>。</p>
                                    <p>今天我们在谈技术架构，有时候我们也会谈产品架构，再往前走，我们会谈商业架构，它中间都是一个结构的问题。</p>
                                    <p><strong>技术最重要的目标是开始追求生产效率，带来产能上的巨大提升</strong>，当产能得到一个巨大提升之后，就能够创造出越来越多的产品，进而实现规模化。技术要通过架构师或者工程师的工作才能完成这个过程。</p>
                                    <p><strong>技术要走向的就是规模化</strong></p>
                                    <blockquote>
                                        <p><strong>计算机真正在做的事情是模拟</strong></p>
                                        <p>创造</p>
                                    </blockquote>
                                    <h2 id="闭环"><a href="#闭环" class="headerlink" title="闭环"></a>闭环</h2>
                                    <p>在职场中,在领导口中.口口声声说 “闭环”,但 究竟什么是闭环?</p>
                                    <p>闭环思维是一种<strong>有始有终</strong>的思维，它是一份生活的智慧。</p>
                                    <p>比如拖延症导致的熬夜。由于有拖延症，导致无法及时完成任务，最后不得不熬夜，第二天精神萎靡，工作效率下降，于是不得不继续熬夜。这就是一个恶性闭环。</p>
                                    <p>要想改变这个闭环，我们需要找到一个突破点，对上一个阶段的效果进行总结，把控改进方向。</p>
                                    <p>工作效率就是一个突破点，我们可以提升工作效率，原本需要2个小时完成的任务，火力全开用1个小时做完，那么晚上就不需要再熬夜了。有了充足的睡眠，第二天精力充沛，就可以保证工作效率，于是形成了一个正向的闭环。</p>
                                    <h3 id="什么是闭环思维"><a href="#什么是闭环思维" class="headerlink" title="什么是闭环思维"></a>什么是闭环思维</h3>
                                    <p>闭环思维实际上被称为反馈控制系统，它将系统输出的测量值与预期和定值进行比较，由此造成一个偏差信号，然后运用偏差去做调整，便于输出值尽可能接近期望值。</p>
                                    <p>PDCA循环将管理分为计划（Plan）、执行（Do）、检查（Check）、行动（Act） 四个阶段，这四个阶段不是独立存在的，而是周而复始的循环。这也是我们在企业中经常听到的“商业闭环”“闭环管理” 等概念。</p>
                                    <p>我们这里提到的闭环思维是指在一定的基础上，对于他人发起的活动或者工作，无论我们完成的程度如何，都要在要求的时间之内认真地反馈给发起人，并且每个活动或者工作都要贯穿这个思维。</p>
                                    <h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2>
                                    <figure class="highlight tex">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">你需要有体系结构化思维的能力 -- 5w3h<span class="tag">\<span class="name"> </span></span>6why</span><br><span class="line">你做的事情它有什么独特的优势,价值点在哪里 </span><br><span class="line">你是否做出了壁垒,形成核心竞争力</span><br><span class="line">你做的事情差异化在哪里</span><br><span class="line">你的事情是否沉淀了一套可复用的物理资料与方法论</span><br><span class="line">为什么是你来做,其他人是否可以?</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>理解业务</p>
                                    <p>技术 + 产品 + 运营</p>
                                    <h2 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h2>
                                    <p><a href="https://baijiahao.baidu.com/s?id=1712470063172799453" target="_blank" rel="noopener">闭环</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-12 21:58:59" itemprop="dateCreated datePublished" datetime="2022-06-12T21:58:59+08:00">2022-06-12</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>774</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/971504142.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> github <i class="label-arrow"></i>
                                    </a>
                                    <a href="/971504142.html" class="post-title-link" itemprop="url">github项目搜索技巧</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="搜项目大全"><a href="#搜项目大全" class="headerlink" title="搜项目大全"></a>搜项目大全</h2>
                                    <p>awesome-xxx</p>
                                    <p>例如想了解python的所有技术体系,我们就可以搜索 awesome-python ,当然Java\spider\datascience等等</p>
                                    <h2 id="搜索样例"><a href="#搜索样例" class="headerlink" title="搜索样例"></a>搜索样例</h2>
                                    <p>xxx simple 或者 xxx demo</p>
                                    <h2 id="空项目结构"><a href="#空项目结构" class="headerlink" title="空项目结构"></a>空项目结构</h2>
                                    <p>xxx starter</p>
                                    <p>例如</p>
                                    <p>springboot starter</p>
                                    <p>springboot+mybatis starter</p>
                                    <h2 id="教程与学习路线"><a href="#教程与学习路线" class="headerlink" title="教程与学习路线"></a>教程与学习路线</h2>
                                    <p>xxx tutorial</p>
                                    <p>例如: python tutorial</p>
                                    <blockquote>
                                        <p>当然结合 <code>awesome-xxx</code> 更香哦</p>
                                    </blockquote>
                                    <h2 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h2>
                                    <p>s: 快速定位到搜索框进行搜索</p>
                                    <p>t: 项目文件树</p>
                                    <p><code>ctrl + K</code> : 快速查看文件</p>
                                    <p><code>.</code>: 在线预览\运行项目</p>
                                    <p>快捷键: <a href="https://docs.github.com/cn/get-started/using-github/keyboard-shortcuts" target="_blank" rel="noopener">https://docs.github.com/cn/get-started/using-github/keyboard-shortcuts</a></p>
                                    <p>GitHub Search: <a href="https://github.com/search/advanced" target="_blank" rel="noopener">https://github.com/search/advanced</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-11 16:48:46" itemprop="dateCreated datePublished" datetime="2022-06-11T16:48:46+08:00">2022-06-11</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>389</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/421021414.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> Android <i class="label-arrow"></i>
                                    </a>
                                    <a href="/421021414.html" class="post-title-link" itemprop="url">android投屏工具</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <p><strong>scrcpy</strong></p>
                                    <p><a href="https://github.com/Genymobile/scrcpy/" target="_blank" rel="noopener">https://github.com/Genymobile/scrcpy/</a></p>
                                    <p><strong>vysor</strong></p>
                                    <p><a href="https://www.vysor.io/" target="_blank" rel="noopener">https://www.vysor.io/</a></p>
                                    <p><strong>QtScrcpy</strong></p>
                                    <p><a href="https://github.com/barry-ran/QtScrcpy" target="_blank" rel="noopener">https://github.com/barry-ran/QtScrcpy</a></p>
                                    <p><strong>Total Control</strong></p>
                                    <p><a href="https://www.sigma-rt.com/" target="_blank" rel="noopener">https://www.sigma-rt.com/</a></p>
                                    <p><strong>Appetizer</strong></p>
                                    <p><a href="https://www.notion.so/appetizerio/AppetizerIO-1383d971ded94388b8e76f3236fe1f4f" target="_blank" rel="noopener">https://www.notion.so/appetizerio/AppetizerIO-1383d971ded94388b8e76f3236fe1f4f</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-06-06 07:54:36" itemprop="dateCreated datePublished" datetime="2022-06-06T07:54:36+08:00">2022-06-06</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>238</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1931754723.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> source code <i class="label-arrow"></i>
                                    </a>
                                    <a href="/1931754723.html" class="post-title-link" itemprop="url">源码阅读技巧</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <blockquote>
                                        <p>本文仅提供思路，还需自身有足够的基础。</p>
                                    </blockquote>
                                    <p>很多时候通常需要阅读很多源码，当然阅读源码也是有很多技巧的。</p>
                                    <p>通常，根据他人总结的文档，先看整体（目录和类图）再看局部（类和函数）。</p>
                                    <p>对于 Java 项目，就是先查看包的层级关系，然后分析包中类（接口）之间的关系，包括继承、实现、委托、方法调用等，最后再查看某个类具体的属性和方法的具体实现。</p>
                                    <p>对于Python 项目，也是这样，先整体后局部，后核心。遵循先广度在深度，先核心在周围</p>
                                    <h2 id="源码阅读基本步骤"><a href="#源码阅读基本步骤" class="headerlink" title="源码阅读基本步骤"></a>源码阅读基本步骤</h2>
                                    <p>首先是通读官方文档，对框架或项目有个大致的了解</p>
                                    <p>学习一些基础库及联系紧密的方法</p>
                                    <p>找到一个趁手的IDEA，深层沉浸式阅读</p>
                                    <p>尝试二次开发、修源码进行深入理解</p>
                                    <h2 id="源码阅读小技巧"><a href="#源码阅读小技巧" class="headerlink" title="源码阅读小技巧"></a>源码阅读小技巧</h2>
                                    <h3 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h3>
                                    <h4 id="根据文件名搜索文件-类等搜索"><a href="#根据文件名搜索文件-类等搜索" class="headerlink" title="根据文件名搜索文件/类等搜索"></a>根据文件名搜索文件/类等搜索</h4>
                                    <p>快捷键：shift + shift（连按两次）</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2qk0490gjj20u00v8myv.jpg" alt="image-20220530172201840"></p>
                                    <h4 id="字段搜索"><a href="#字段搜索" class="headerlink" title="字段搜索"></a><strong>字段搜索</strong></h4>
                                    <p>局部搜索快捷键：Win: Ctrl + F Mac: Command + F</p>
                                    <p>全局搜索快捷键：Win: Ctrl + shift + F Mac: Command + Shift + F</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2qk2z3utsj20xm0t0djk.jpg" alt="image-20220530172449113"></p>
                                    <h3 id="代码跳转"><a href="#代码跳转" class="headerlink" title="代码跳转"></a>代码跳转</h3>
                                    <p><strong>对应文件跳转</strong></p>
                                    <p>Mac快捷键：Command + e Win快捷键：Ctrl + e</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2qkvg0g5kj20so0ig400.jpg" alt="image-20220530175210390"></p>
                                    <p><strong>跳转到上/下次光标的位置</strong></p>
                                    <p>查看源码时，经常需要在两个类中来回跳转，这个功能就变得相当实用！</p>
                                    <p>查看上次光标位置快捷键：Win: Alt + ← Mac: Option + Command + ←</p>
                                    <p>查看下次光标位置快捷键：Win: Alt + → Mac: Option + Command + →</p>
                                    <h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4>
                                    <p><strong>查看方法调用树</strong></p>
                                    <p>可以查看指定方法的所有调用方和被调方。</p>
                                    <p>快捷键：Win: Ctrl + Alt + H MAC： Control + Option + H</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2qkyity7aj20qq0cydgo.jpg" alt="image-20220530175508252"></p>
                                    <p>调用与被调用</p>
                                    <h4 id="方法函数结构"><a href="#方法函数结构" class="headerlink" title="方法函数结构"></a>方法函数结构</h4>
                                    <p>快捷键：快捷键：Win: Alt + 7 Mac: Command + 7</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2qkzo9kl2j212q0gy0tl.jpg" alt="image-20220530175614503"></p>
                                    <h4 id="类关系"><a href="#类关系" class="headerlink" title="类关系"></a>类关系</h4>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h4ciu295kqj20e6030t8p.jpg" alt="image-20220719204419565"></p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h4civ1gl90j21280h0dh9.jpg" alt="image-20220719204515904"></p>
                                    <h2 id="referer"><a href="#referer" class="headerlink" title="referer"></a>referer</h2>
                                    <p><a href="https://juejin.cn/post/7012168150493954079#heading-3" target="_blank" rel="noopener">https://juejin.cn/post/7012168150493954079#heading-3</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-05-30 16:48:02" itemprop="dateCreated datePublished" datetime="2022-05-30T16:48:02+08:00">2022-05-30</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>741</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/3361156693.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> Jetbrains <i class="label-arrow"></i>
                                    </a>
                                    <a href="/3361156693.html" class="post-title-link" itemprop="url">Jetbrains plugins</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Jetbrains-plugins"><a href="#Jetbrains-plugins" class="headerlink" title="Jetbrains plugins"></a>Jetbrains plugins</h2>
                                    <h3 id="通用"><a href="#通用" class="headerlink" title="通用"></a>通用</h3>
                                    <p>ignore：生成git、dodkcer配置文件</p>
                                    <p>Node.js：提供nodejs 支持</p>
                                    <p>CSV: 用于编辑 CSV/TSV/PSV 文件的轻量级插件，具有灵活的表格编辑器、语法验证、结构突出显示、可自定义的颜色、新意图和有用的检查。</p>
                                    <p>Rainbow CSV：用于以不同颜色突出显示 CSV 文件的插件。</p>
                                    <p>Rainbow：基于 IntelliJ IDEA 的 IDE 的彩虹高亮标识符和分隔符</p>
                                    <p><a href="https://www.tabnine.com/install" target="_blank" rel="noopener">Tabnine</a>： 代码智能提示</p>
                                    <p>Ideolog： “.log”文件的交互式查看器。</p>
                                    <p>CodeGlance Pro：提供代码缩略图</p>
                                    <p>env files support：基于 .env、Dockerfile 和 docker-compose.yml 文件的环境变量补全。</p>
                                    <p>BashSupport Pro：是用于高级Bash和shell脚本开发的插件—调试器、测试运行程序、代码完成、查找用法、重命名、ShellCheck、shfmt等。</p>
                                    <p>Key Promoter X：提供快捷键提示</p>
                                    <p>Nyan Progress Bar：彩虹进度条</p>
                                    <p>translation： 翻译插件</p>
                                    <p>Markdown：提供markdown 格式支持</p>
                                    <p>Monokai Pro：主题</p>
                                    <p>Graph Buddy: 旨在加快您阅读和学习源代码的过程。Graph Buddy 插件提供了一组有用的功能和技术，可帮助您轻松浏览扭曲的代码依赖项。同时，它可以让您更好地了解代码库中的代码结构。</p>
                                    <p>Material Theme UI Plugin： 提供主题</p>
                                    <p>Material Design Dark-Theme: 黑暗主题</p>
                                    <p>AEM IDE： 保护您避免引入讨厌的错误，在编写代码时给您反馈</p>
                                    <p>Save Actions：格式化代码插件</p>
                                    <p>Grep console: 自定义控制台输出</p>
                                    <p>statistic：代码统计插件</p>
                                    <p>GitToolBox： git增强</p>
                                    <h3 id="Pycharm"><a href="#Pycharm" class="headerlink" title="Pycharm"></a>Pycharm</h3>
                                    <p><a href="https://intellij-aem.gitlab.io/" target="_blank" rel="noopener">AEM</a> PRO: 本部分提供有关开始使用 IntelliJ AEM 所需步骤的信息，包括插件安装和初始项目设置。</p>
                                    <p>Sourcery 是一个人工智能驱动的编码助手，它可以帮助你更快地编写更好的 Python 代码。它通过动态提供重构建议来工作，您可以立即将这些建议集成到您的代码中。</p>
                                    <h3 id="Idea"><a href="#Idea" class="headerlink" title="Idea"></a>Idea</h3>
                                    <p>Codota: 代码智能提示</p>
                                    <p>Lombok：简化臃肿代码插件</p>
                                    <p>Alibaba Java Coding Guidelines：阿里巴巴代码规范检查插件</p>
                                    <p>CamelCase： 驼峰命名和下划线命名转换</p>
                                    <p>MybatisX：高效操作 MybatisX 插件</p>
                                    <p>SonarLint：代码质量检查插件</p>
                                    <p>checkstyle：代码风格检查插件</p>
                                    <p>MetricsReloaded 代码复杂度检查插件</p>
                                    <p>Jump To Line: 转到任意行并设置执行点而无需执行前面的代码。</p>
                                    <p>Maven helper: 查看、分析和排除相互冲突的依赖项</p>
                                    <p>Squaretest: 自动生成单元测试</p>
                                    <p>Jrebel：热部署插件</p>
                                    <p>EasyCode： 数据库表自动的生成实体类</p>
                                    <p>Arthas Idea： Java 在线诊断工具</p>
                                    <p>源码插件技巧：<a href="https://juejin.cn/post/7012168150493954079" target="_blank" rel="noopener">https://juejin.cn/post/7012168150493954079</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-05-29 00:41:19" itemprop="dateCreated datePublished" datetime="2022-05-29T00:41:19+08:00">2022-05-29</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.2k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/586178490.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> go <i class="label-arrow"></i>
                                    </a>
                                    <a href="/586178490.html" class="post-title-link" itemprop="url">go-reflect</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="反射简介"><a href="#反射简介" class="headerlink" title="反射简介"></a>反射简介</h2>
                                    <p>Go在标准库中提供的reflect包让Go程序具备运行时的反射能力（reflection）。反射是程序在运行时访问、检测和修改它本身状态或行为的一种能力，各种编程语言所实现的反射机制各有不同。</p>
                                    <p>Go语言的<code>interface{}</code>类型变量具有析出任意类型变量的类型信息（type）和值信息（value）的能力，Go的反射本质上就是利用<code>interface{}</code><br>的这种能力在运行时对任意变量的类型和值信息进行检视甚至是对值进行修改的机制。</p>
                                    <p>反射让静态类型语言Go在运行时具备了某种基于类型信息的动态特性。利用这种特性，fmt.Println在无法提前获知传入参数的真正类型的情况下依旧可以对其进行正确的格式化输出</p>
                                    <h2 id="反射三大法则"><a href="#反射三大法则" class="headerlink" title="反射三大法则"></a>反射三大法则</h2>
                                    <p>Rob Pike还为Go反射的规范使用定义了三大法则，如果经过评估，你必须使用反射才能实现你要的功能特性，那么你在使用反射时需要牢记这三条法则。</p>
                                    <ul>
                                        <li>反射世界的入口：经由接口（interface{}）类型变量值进入反射的世界并获得对应的反射对象（reflect.Value或reflect.Type）。</li>
                                        <li>反射世界的出口：反射对象（reflect.Value）通过化身为一个接口（interface{}）类型变量值的形式走出反射世界。</li>
                                        <li>修改反射对象的前提：反射对象对应的reflect.Value必须是可设置的（Settable）。</li>
                                    </ul>
                                    <p>reflect.TypeOf和reflect.ValueOf是进入反射世界仅有的两扇“大门”。通过reflect.TypeOf这扇“门”进入反射世界，你将得到一个reflect.Type对象，该对象中包含了被反射的Go变量实例的所有类型信息；</p>
                                    <p>而通过reflect.ValueOf这扇“门”进入反射世界，你将得到一个reflect.Value对象。Value对象是反射世界的核心，不仅该对象中包含了被反射的Go变量实例的值信息，而且通过调用该对象的Type方法，我们还可以得到Go变量实例的类型信息，这与通过reflect.TypeOf获得类型信息是等价的：</p>
                                    <p>reflect.Value.Interface()是reflect.ValueOf()<br>的逆过程，通过Interface方法我们可以将reflect.Value对象恢复成一个interface{}类型的变量值。这个离开反射世界的过程实质是将reflect.Value中的类型信息和值信息重新打包成一个interface{}的内部表示。</p>
                                    <h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2>
                                    <p>reflect包所提供的Go反射能力是一把“双刃剑”，它既可以被用于优雅地解决一类特定的问题，但也会带来逻辑不清晰、性能问题以及难于发现问题和调试等困惑。<br>因此，我们应谨慎使用这种能力，在做出使用的决定之前，认真评估反射是不是问题的唯一解决方案；在确定要使用反射能力后，也要遵循上述三个反射法则的要求。</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-05-02 21:46:53" itemprop="dateCreated datePublished" datetime="2022-05-02T21:46:53+08:00">2022-05-02</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.2k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/984068165.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> go <i class="label-arrow"></i>
                                    </a>
                                    <a href="/984068165.html" class="post-title-link" itemprop="url">go-unsafe</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Go标准库"><a href="#Go标准库" class="headerlink" title="Go标准库"></a>Go标准库</h2>
                                    <p>Go标准库中的unsafe包非常简洁，如下所示</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// 用于获取一个表达式值的大小</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sizeof</span><span class="params">(x ArbitraryType)</span> <span class="title">uintptr</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于获取结构体中某字段段地址偏移量（相对于结构体变量的地址）</span></span><br><span class="line"><span class="comment">// Offsetof函数应用面较窄，仅用于结构体某字段的偏移值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Offsetof</span><span class="params">(x ArbitraryType)</span> <span class="title">uintptr</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Alignof用于获取一个表达式的内存补齐系数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Alignof</span><span class="params">(x ArbitraryType)</span> <span class="title">uintptr</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Add 将 len 添加到 ptr 并返回更新后的指针 Pointer(uintptr(ptr) + uintptr(len))。</span></span><br><span class="line"><span class="comment">// len 参数必须是整数类型或无类型常量。</span></span><br><span class="line"><span class="comment">// 一个常量 len 参数必须可以用一个 int 类型的值来表示；</span></span><br><span class="line"><span class="comment">// 如果它是一个无类型常量，它被赋予 int 类型。 Pointer 的有效使用规则仍然适用。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(ptr Pointer, <span class="built_in">len</span> IntegerType)</span> <span class="title">Pointer</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数 Slice 返回一个切片，其底层数组从 ptr 开始，长度和容量为 len。 </span></span><br><span class="line"><span class="comment">// Slice(ptr, len) 等价于 ([len]ArbitraryType)(unsafe.Pointer(ptr))[:] ，</span></span><br><span class="line"><span class="comment">// 除了作为特殊情况，如果 ptr 为 nil 且 len 为零，Slice 返回 nil。 </span></span><br><span class="line"><span class="comment">// len 参数必须是整数类型或无类型常量。</span></span><br><span class="line"><span class="comment">// 一个常量 len 参数必须是非负的并且可以用一个int类型的值来表示；</span></span><br><span class="line"><span class="comment">// 如果它是一个无类型常量，它被赋予int类型。在运行时，</span></span><br><span class="line"><span class="comment">// 如果len为负数，或者ptr为nil且len不为零，则会发生运行时恐慌</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Slice</span><span class="params">(ptr *ArbitraryType, <span class="built_in">len</span> IntegerType)</span> []<span class="title">ArbitraryType</span></span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="典型使用"><a href="#典型使用" class="headerlink" title="典型使用"></a>典型使用</h3>
                                    <p>怎么理解Go核心团队在尽力保证go类型安全的情况下，又提供了可以打破安全屏障的<code>unsafe.Pointer</code> 这一行为？</p>
                                    <p>首先被广泛应用于Go标准库和Go 运行时的实现当中，reflect、sync、syscall、runtime都是unsafe包的重度用户。</p>
                                    <h4 id="reflect"><a href="#reflect" class="headerlink" title="reflect"></a>reflect</h4>
                                    <p>ValueOf 和TypeOf函数是reflect包中用得最多的两个API，他们是进入运行时反射层、获取发射层信息的入口。这两个函数均将任意类型变量转化为一个<code>interface{}</code> 类型变量，再利用<code>unsafe.Pointer</code><br>将这个变量绑定的内存区域重新解释为reflect.emptyInterface类型，以获得传入变量的类型和值类的信息</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// $GOROOT/src/reflect/values.go</span></span><br><span class="line"><span class="comment">// emptyInterface is the header for an interface&#123;&#125; value.</span></span><br><span class="line"><span class="keyword">type</span> emptyInterface <span class="keyword">struct</span> &#123;</span><br><span class="line">	typ  *rtype</span><br><span class="line">	word unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// unpackEface converts the empty interface i to a Value.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unpackEface</span><span class="params">(i any)</span> <span class="title">Value</span></span> &#123;</span><br><span class="line">	e := (*emptyInterface)(unsafe.Pointer(&amp;i))</span><br><span class="line">	<span class="comment">// <span class="doctag">NOTE:</span> don't read e.word until we know whether it is really a pointer or not.</span></span><br><span class="line">	t := e.typ</span><br><span class="line">	<span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Value&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	f := flag(t.Kind())</span><br><span class="line">	<span class="keyword">if</span> ifaceIndir(t) &#123;</span><br><span class="line">		f |= flagIndir</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Value&#123;t, e.word, f&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $GOROOT/src/reflect/type.go</span></span><br><span class="line"><span class="comment">// If i is a nil interface value, TypeOf returns nil.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeOf</span><span class="params">(i any)</span> <span class="title">Type</span></span> &#123;</span><br><span class="line">	eface := *(*emptyInterface)(unsafe.Pointer(&amp;i))</span><br><span class="line">	<span class="keyword">return</span> toType(eface.typ)</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h4 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h4>
                                    <p>sync.Pool 是个并发安全的高性能临时对象缓冲池。Pool 为每个P分配了一个本地缓冲池，并通过下列函数为每个P分配啦一个本地的缓冲池，并通过如下函数实现快速定位P的本地缓冲池。</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexLocal</span><span class="params">(l unsafe.Pointer, i <span class="keyword">int</span>)</span> *<span class="title">poolLocal</span></span> &#123;</span><br><span class="line">	lp := unsafe.Pointer(<span class="keyword">uintptr</span>(l) + <span class="keyword">uintptr</span>(i)*unsafe.Sizeof(poolLocal&#123;&#125;))</span><br><span class="line">	<span class="keyword">return</span> (*poolLocal)(lp)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// indexLocal函数的本地缓冲池快速定位时通过结合unsafe.Pointer包与uinptr的指针运算实现</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>标准库中的saycall包封装了与操作系统交互的系统调用接口，比如Statfs、Listen、Select</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// $GOROOT/src/syscall/zsyscall_linux_amd64.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Statfs</span><span class="params">(path <span class="keyword">string</span>, buf *Statfs_t)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> _p0 *<span class="keyword">byte</span></span><br><span class="line">	_p0, err = BytePtrFromString(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	_, _, e1 := Syscall(SYS_STATFS, <span class="keyword">uintptr</span>(unsafe.Pointer(_p0)), <span class="keyword">uintptr</span>(unsafe.Pointer(buf)), <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">if</span> e1 != <span class="number">0</span> &#123;</span><br><span class="line">		err = errnoErr(e1)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Listen</span><span class="params">(s <span class="keyword">int</span>, n <span class="keyword">int</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	_, _, e1 := Syscall(SYS_LISTEN, <span class="keyword">uintptr</span>(s), <span class="keyword">uintptr</span>(n), <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">if</span> e1 != <span class="number">0</span> &#123;</span><br><span class="line">		err = errnoErr(e1)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Select</span><span class="params">(nfd <span class="keyword">int</span>, r *FdSet, w *FdSet, e *FdSet, timeout *Timeval)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">	r0, _, e1 := Syscall6(SYS_SELECT, <span class="keyword">uintptr</span>(nfd), <span class="keyword">uintptr</span>(unsafe.Pointer(r)), <span class="keyword">uintptr</span>(unsafe.Pointer(w)), <span class="keyword">uintptr</span>(unsafe.Pointer(e)), <span class="keyword">uintptr</span>(unsafe.Pointer(timeout)), <span class="number">0</span>)</span><br><span class="line">	n = <span class="keyword">int</span>(r0)</span><br><span class="line">	<span class="keyword">if</span> e1 != <span class="number">0</span> &#123;</span><br><span class="line">		err = errnoErr(e1)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>这类的高级调用的最终都会落到调用函数下面一系列的Syscall和RawSyscall函数上面。</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Syscall</span><span class="params">(trap, a1, a2, a3 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Syscall6</span><span class="params">(trap, a1, a2, a3, a4, a5, a6 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RawSyscall</span><span class="params">(trap, a1, a2, a3 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RawSyscall6</span><span class="params">(trap, a1, a2, a3, a4, a5, a6 <span class="keyword">uintptr</span>)</span> <span class="params">(r1, r2 <span class="keyword">uintptr</span>, err Errno)</span></span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>这些Saycall系列的函数接受的参数类型均为uintptr，这样当封装的系统调用的参数为指针类型时（比如上面Select的参数r、w、e等）。只能只能通过unsafe.uintptr值，就像上面Select函数实现中那样。因此，syscall包是unsafe重度使用者，它的实现离不开的unsafe.Pointer。</p>
                                    <h4 id="runtime包中的unsafe包的典型应用"><a href="#runtime包中的unsafe包的典型应用" class="headerlink" title="runtime包中的unsafe包的典型应用"></a>runtime包中的unsafe包的典型应用</h4>
                                    <p>runtime 包实现的goroutine调度和内存管理（包括GC）都有unsafe包的身影以goroutine的栈管理为例：</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// $GOROOT/src/runtime/stack.go</span></span><br><span class="line"><span class="keyword">type</span> stack <span class="keyword">struct</span> &#123;</span><br><span class="line">	lo <span class="keyword">uintptr</span></span><br><span class="line">	hi <span class="keyword">uintptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $GOROOT/src/runtime/runtime.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stackalloc</span><span class="params">(n <span class="keyword">uint32</span>)</span> <span class="title">stack</span></span> &#123;</span><br><span class="line">	<span class="comment">// Stackalloc must be called on scheduler stack, so that we</span></span><br><span class="line">	<span class="comment">// never try to grow the stack during the code that stackalloc runs.</span></span><br><span class="line">	<span class="comment">// Doing so would cause a deadlock (issue 1547).</span></span><br><span class="line">	thisg := getg()</span><br><span class="line">	<span class="keyword">if</span> thisg != thisg.m.g0 &#123;</span><br><span class="line">		throw(<span class="string">"stackalloc not on scheduler stack"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> n&amp;(n<span class="number">-1</span>) != <span class="number">0</span> &#123;</span><br><span class="line">		throw(<span class="string">"stack size not a power of 2"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> stackDebug &gt;= <span class="number">1</span> &#123;</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">"stackalloc "</span>, n, <span class="string">"\n"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> debug.efence != <span class="number">0</span> || stackFromSystem != <span class="number">0</span> &#123;</span><br><span class="line">		n = <span class="keyword">uint32</span>(alignUp(<span class="keyword">uintptr</span>(n), physPageSize))</span><br><span class="line">		v := sysAlloc(<span class="keyword">uintptr</span>(n), &amp;memstats.stacks_sys)</span><br><span class="line">		<span class="keyword">if</span> v == <span class="literal">nil</span> &#123;</span><br><span class="line">			throw(<span class="string">"out of memory (stackalloc)"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> stack&#123;<span class="keyword">uintptr</span>(v), <span class="keyword">uintptr</span>(v) + <span class="keyword">uintptr</span>(n)&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Small stacks are allocated with a fixed-size free-list allocator.</span></span><br><span class="line">	<span class="comment">// If we need a stack of a bigger size, we fall back on allocating</span></span><br><span class="line">	<span class="comment">// a dedicated span.</span></span><br><span class="line">	<span class="keyword">var</span> v unsafe.Pointer</span><br><span class="line">	<span class="keyword">if</span> n &lt; _FixedStack&lt;&lt;_NumStackOrders &amp;&amp; n &lt; _StackCacheSize &#123;</span><br><span class="line">		order := <span class="keyword">uint8</span>(<span class="number">0</span>)</span><br><span class="line">		n2 := n</span><br><span class="line">		<span class="keyword">for</span> n2 &gt; _FixedStack &#123;</span><br><span class="line">			order++</span><br><span class="line">			n2 &gt;&gt;= <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> x gclinkptr</span><br><span class="line">		<span class="keyword">if</span> stackNoCache != <span class="number">0</span> || thisg.m.p == <span class="number">0</span> || thisg.m.preemptoff != <span class="string">""</span> &#123;</span><br><span class="line">			<span class="comment">// thisg.m.p == 0 can happen in the guts of exitsyscall</span></span><br><span class="line">			<span class="comment">// or procresize. Just get a stack from the global pool.</span></span><br><span class="line">			<span class="comment">// Also don't touch stackcache during gc</span></span><br><span class="line">			<span class="comment">// as it's flushed concurrently.</span></span><br><span class="line">			lock(&amp;stackpool[order].item.mu)</span><br><span class="line">			x = stackpoolalloc(order)</span><br><span class="line">			unlock(&amp;stackpool[order].item.mu)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			c := thisg.m.p.ptr().mcache</span><br><span class="line">			x = c.stackcache[order].list</span><br><span class="line">			<span class="keyword">if</span> x.ptr() == <span class="literal">nil</span> &#123;</span><br><span class="line">				stackcacherefill(c, order)</span><br><span class="line">				x = c.stackcache[order].list</span><br><span class="line">			&#125;</span><br><span class="line">			c.stackcache[order].list = x.ptr().next</span><br><span class="line">			c.stackcache[order].size -= <span class="keyword">uintptr</span>(n)</span><br><span class="line">		&#125;</span><br><span class="line">		v = unsafe.Pointer(x)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> s *mspan</span><br><span class="line">		npage := <span class="keyword">uintptr</span>(n) &gt;&gt; _PageShift</span><br><span class="line">		log2npage := stacklog2(npage)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Try to get a stack from the large stack cache.</span></span><br><span class="line">		lock(&amp;stackLarge.lock)</span><br><span class="line">		<span class="keyword">if</span> !stackLarge.free[log2npage].isEmpty() &#123;</span><br><span class="line">			s = stackLarge.free[log2npage].first</span><br><span class="line">			stackLarge.free[log2npage].remove(s)</span><br><span class="line">		&#125;</span><br><span class="line">		unlock(&amp;stackLarge.lock)</span><br><span class="line"></span><br><span class="line">		lockWithRankMayAcquire(&amp;mheap_.lock, lockRankMheap)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="comment">// Allocate a new stack from the heap.</span></span><br><span class="line">			s = mheap_.allocManual(npage, spanAllocStack)</span><br><span class="line">			<span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">				throw(<span class="string">"out of memory"</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			osStackAlloc(s)</span><br><span class="line">			s.elemsize = <span class="keyword">uintptr</span>(n)</span><br><span class="line">		&#125;</span><br><span class="line">		v = unsafe.Pointer(s.base())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">		racemalloc(v, <span class="keyword">uintptr</span>(n))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> msanenabled &#123;</span><br><span class="line">		msanmalloc(v, <span class="keyword">uintptr</span>(n))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> asanenabled &#123;</span><br><span class="line">		asanunpoison(v, <span class="keyword">uintptr</span>(n))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> stackDebug &gt;= <span class="number">1</span> &#123;</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">"  allocated "</span>, v, <span class="string">"\n"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> stack&#123;<span class="keyword">uintptr</span>(v), <span class="keyword">uintptr</span>(v) + <span class="keyword">uintptr</span>(n)&#125;</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="unsafe-Pointer-与-uintptr"><a href="#unsafe-Pointer-与-uintptr" class="headerlink" title="unsafe.Pointer 与 uintptr"></a>unsafe.Pointer 与 uintptr</h2>
                                    <p>作为Go类型安全层上的一个“后门”，unsafe包在带来强大的低级编程能力的同时，也极容易导致代码出现错误。而出现浙西错误的原因主要就是对unsafe.Pointer和uintptr的理解不到位。因此正确理解unsafe.Pointer和uintptr对于安全使用unsafe包非常有必要。</p>
                                    <p>Go语言内存管理是基于垃圾回收的，垃圾回收会定期进行，如歌一块内存没有被任何对象引用，他就会被垃圾回收器回收掉，而对象引用是通过指针实现的。</p>
                                    <p>unsafe.Pointer 和其他常规类型的指针一样，可以作为对象引用。如果一个对象仍然被某个unsafe.Pointer 变量引用着则该对象不会被回收（垃圾回收）。</p>
                                    <p><strong>即使他存储的是某个对象的内存地址值，它也不会被算作该对象的被算作对该对象的引用</strong></p>
                                    <p><strong>如果认为将对象地址存储在一个uintptr变量中，该对象就不会被垃圾回收器回收，那是对uintptr的最大误解</strong></p>
                                    <h2 id="安全使用"><a href="#安全使用" class="headerlink" title="安全使用"></a>安全使用</h2>
                                    <p>我们既需要unsafe.Pointer打破类型的安全屏障，又需要器能够被安全的使用。如下有几条安全法则</p>
                                    <h3 id="T1-gt-unsafe-Pointer-gt-T2"><a href="#T1-gt-unsafe-Pointer-gt-T2" class="headerlink" title="*T1 -&gt; unsafe.Pointer -&gt; *T2"></a><code>*T1</code> -&gt; unsafe.Pointer -&gt; <code>*T2</code></h3>
                                    <p>其本质就是内存重解释，将原本解释为T1的类型内存重新解释为T2类型。</p>
                                    <blockquote>
                                        <p>这是unsafe.Pointer 突破Go类型安全的屏障的基本使用模式</p>
                                    </blockquote>
                                    <p>注意：转换后类型T2, 对对其系数不能比转换前类型T1的对其系数<strong>更严格</strong>，即Alignof(T1) =&gt; Alignof(T2)</p>
                                    <h3 id="unsafe-Pointer-gt-uintptr"><a href="#unsafe-Pointer-gt-uintptr" class="headerlink" title="unsafe.Pointer -&gt; uintptr"></a>unsafe.Pointer -&gt; uintptr</h3>
                                    <p>将unsafe.Pointer 显示转换为uinptr，并且转换后的uintptr类型不会在转换回unsafe.Pointer 只用于打印输出，并不参与其他操作。</p>
                                    <h3 id="模拟指针运算"><a href="#模拟指针运算" class="headerlink" title="模拟指针运算"></a>模拟指针运算</h3>
                                    <p>操作任意内存地址上的数据都离不开指针运算。Go常规语法不支持指针运算，但我们可以使用unsafe.Pointer的第三种安全使用模式来模拟指针运算，即在一个表达式中，将unsafe.Pointer转换为uintptr类型，使用uintptr类型的值进行算术运算后，再转换回unsafe.Pointer</p>
                                    <p>经常用于访问结构体内字段或数组中的元素，也常用于实现对某内存对象的步进式检查</p>
                                    <p>注意事项:</p>
                                    <ul>
                                        <li>不要越界offset理论上可以是任意值，这就存在算术运算之后的地址超出原内存对象边界的可能。 经过转换后，p指向的地址已经超出原数组a的边界，访问这块内存区域是有风险的，尤其是当你尝试去修改它的时候。</li>
                                        <li>unsafe.Pointer -&gt; uintptr -&gt; unsafe.Pointer的转换要在一个表达式中</li>
                                    </ul>
                                    <h3 id="调用syscall-Syscall系列函数时指针类型到uintptr类型参数的转换"><a href="#调用syscall-Syscall系列函数时指针类型到uintptr类型参数的转换" class="headerlink" title="调用syscall.Syscall系列函数时指针类型到uintptr类型参数的转换"></a>调用syscall.Syscall系列函数时指针类型到uintptr类型参数的转换</h3>
                                    <h3 id="将reflect-Value-Pointer或reflect-Value-UnsafeAddr转换为指针"><a href="#将reflect-Value-Pointer或reflect-Value-UnsafeAddr转换为指针" class="headerlink" title="将reflect.Value.Pointer或reflect.Value.UnsafeAddr转换为指针"></a>将reflect.Value.Pointer或reflect.Value.UnsafeAddr转换为指针</h3>
                                    <h3 id="reflect-SliceHeader和reflect-StringHeader必须通过unsafe-Pointer-gt-uintptr构建"><a href="#reflect-SliceHeader和reflect-StringHeader必须通过unsafe-Pointer-gt-uintptr构建" class="headerlink" title="reflect.SliceHeader和reflect.StringHeader必须通过unsafe.Pointer -&gt; uintptr构建"></a>reflect.SliceHeader和reflect.StringHeader必须通过<code>unsafe.Pointer -&gt; uintptr</code>构建</h3>
                                    <h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips:"></a>Tips:</h2>
                                    <p>使用unsfa包前，请牢记并理解unsafe.Pointer 的六条安全使用模式</p>
                                    <p>如果使用了unsafe包，请使用<code>go vet</code> 等工具对代码进行unsafe包使用合规性检查</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-05-01 17:05:31" itemprop="dateCreated datePublished" datetime="2022-05-01T17:05:31+08:00">2022-05-01</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>2.1k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>2 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1679977151.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> go <i class="label-arrow"></i>
                                    </a>
                                    <a href="/1679977151.html" class="post-title-link" itemprop="url">go code tips</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="Go-code-tips"><a href="#Go-code-tips" class="headerlink" title="Go code tips"></a>Go code tips</h2>
                                    <h3 id="使用-pkg-errors"><a href="#使用-pkg-errors" class="headerlink" title="使用 pkg/errors"></a>使用 pkg/errors</h3>
                                    <blockquote>
                                        <p><a href="https://pkg.go.dev/github.com/pkg/errors" target="_blank" rel="noopener">https://pkg.go.dev/github.com/pkg/errors</a></p>
                                    </blockquote>
                                    <p>我们在一个项目中使用错误机制，最核心的几个需求是什么？我觉得主要是这两点：</p>
                                    <ul>
                                        <li>附加信息：我们希望错误出现的时候能附带一些描述性的错误信息，甚至这些信息是可以嵌套的</li>
                                        <li>附加堆栈：我们希望错误不仅仅打印出错误信息，也能打印出这个错误的堆栈信息，可以知道出错的具体代码。</li>
                                    </ul>
                                    <p>在 Go 语言的演进过程中，error 传递的信息太少一直是被诟病的一点。使用官方的 error 库，只能打印一条简单的错误信息，而没有更多的信息辅助快速定位错误。所以，推荐在应用层使用 <code>github.com/pkg/errors</code><br>来替换官方的 error 库。因为使用 <code>pkg/errors</code>，我们不仅能传递出标准库 error 的错误信息，还能传递出抛出 error 的堆栈信息。</p>
                                    <p>官方示例代码如下</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/pkg/errors"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fn</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	e1 := errors.New(<span class="string">"error"</span>)</span><br><span class="line">	e2 := errors.Wrap(e1, <span class="string">"inner"</span>)</span><br><span class="line">	e3 := errors.Wrap(e2, <span class="string">"middle"</span>)</span><br><span class="line">	<span class="keyword">return</span> errors.Wrap(e3, <span class="string">"outer"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">type</span> stackTracer <span class="keyword">interface</span> &#123;</span><br><span class="line">		StackTrace() errors.StackTrace</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err, ok := errors.Cause(fn()).(stackTracer)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"oops, err does not implement stackTracer"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	st := err.StackTrace()</span><br><span class="line">	fmt.Printf(<span class="string">"%+v"</span>, st[<span class="number">0</span>:<span class="number">2</span>]) <span class="comment">// top two frames</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example output:</span></span><br><span class="line">	<span class="comment">// github.com/pkg/errors_test.fn</span></span><br><span class="line">	<span class="comment">//	/home/dfc/src/github.com/pkg/errors/example_test.go:47</span></span><br><span class="line">	<span class="comment">// github.com/pkg/errors_test.Example_stackTrace</span></span><br><span class="line">	<span class="comment">//	/home/dfc/src/github.com/pkg/errors/example_test.go:127</span></span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="在初始化-slice-的时候尽量补全-cap"><a href="#在初始化-slice-的时候尽量补全-cap" class="headerlink" title="在初始化 slice 的时候尽量补全 cap"></a>在初始化 slice 的时候尽量补全 cap</h3>
                                    <blockquote>
                                        <p>当我们要创建一个 slice 结构，并且往 slice 中 append 元素的时候，我们可能有两种写法来初始化这个 slice。</p>
                                    </blockquote>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// 直接使用[]int 的方式来初始化</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    arr := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    arr = <span class="built_in">append</span>(arr, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    fmt.Println(arr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 make 关键字来初始化</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   arr := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">   arr = <span class="built_in">append</span>(arr, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">   fmt.Println(arr)</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>方法二相较于方法一，就只有一个区别：在初始化[]int slice 的时候在 make 中设置了 cap 的长度，就是 slice 的大小。</p>
                                    <p>而且，这两种方法对应的功能和输出结果是没有任何差别的，但是实际运行的时候，方法二会比方法一少运行了一个 growslice 的命令，能够提升我们程序的运行性能。具体我们可以打印汇编码查看一下。</p>
                                    <blockquote>
                                        <p>这个 growslice 的作用就是扩充 slice 容量，每当我们的 slice 容量小于我们需要使用的 slice 大小，这个函数就会被触发。</p>
                                        <p>它的机制就好比是原先我们没有定制容量，系统给了我们一个能装两个鞋子的盒子，但是当我们装到第三个鞋子的时候，这个盒子就不够了，我们就要换一个盒子，而换这个盒子，我们势必还需要将原先的盒子里面的鞋子也拿出来放到新的盒子里面。</p>
                                        <p>而 growsslice 的操作是一个比较复杂的操作，它的表现和复杂度会高于最基本的初始化 make 方法。对追求性能的程序来说，应该能避免就尽量避免。如果你对 growsslice 函数的具体实现感兴趣，你可以参考源码 src 的 runtime/slice.go 。</p>
                                    </blockquote>
                                    <p>当然，并不是每次都能在 slice 初始化的时候，就准确预估到最终的使用容量，所以我这里说的是“尽量补全 cap”。明白是否设置 slice 容量的区别后，我们在能预估容量的时候，请尽量使用方法二那种预估容量后的 slice 初始化方式。</p>
                                    <h3 id="初始化一个类的时候，如果类的构造参数较多，尽量使用-Option-写法"><a href="#初始化一个类的时候，如果类的构造参数较多，尽量使用-Option-写法" class="headerlink" title="初始化一个类的时候，如果类的构造参数较多，尽量使用 Option 写法"></a>初始化一个类的时候，如果类的构造参数较多，尽量使用 Option 写法</h3>
                                    <p>遇到一定要初始化一个类的时候，大部分时候都会使用类似下列的 New 方法：</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">   name <span class="keyword">string</span></span><br><span class="line">   id <span class="keyword">int</span></span><br><span class="line">   age <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">   db <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFoo</span><span class="params">(name <span class="keyword">string</span>, id <span class="keyword">int</span>, age <span class="keyword">int</span>, db <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">Foo</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> &amp;Foo&#123;</span><br><span class="line">      name: name,</span><br><span class="line">      id:   id,</span><br><span class="line">      age:  age,</span><br><span class="line">      db:   db,</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>在这段代码中，我们定义一个 NewFoo 方法，其中存放初始化 Foo 结构所需要的各种字段属性。这个写法乍看之下是没啥问题的，但是一旦 Foo 结构内部的字段发生了变化，增加或者减少了，那么这个初始化函数 NewFoo<br>就怎么看怎么别扭了。参数继续增加？那么所有调用了这个 NewFoo 方法的地方也都需要进行修改，且按照代码整洁的逻辑，参数多于 5 个，这个函数就很难使用了。而且，如果这 5 个参数都是可有可无的参数，就是有的参数可以不填写，有默认值，比如<br>age 这个字段，即使我们不填写，在后续的业务逻辑中可能也没有很多影响，那么我在实际调用 NewFoo 的时候，age 这个字段还需要传递 0 值：</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">foo := NewFoo(<span class="string">"payne"</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">nil</span>)</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>乍看这行代码，你可能会以为我创建了一个 Foo，它的年龄为 0，但是实际上是希望表达这里使用了一个“缺省值”，这种代码的语义逻辑就不对了。</p>
                                    <p>这里其实有一种更好的写法：<strong>使用 Option 写法来进行改造</strong></p>
                                    <p>Option 写法，顾名思义，就是将所有可选的参数作为一个可选方式，一般我们会设计一个“函数类型”来代表这个<br>Option，然后配套将所有可选字段设计为一个这个函数类型的具体实现。在具体的使用的时候，使用可变字段的方式来控制有多少个函数类型会被执行。比如上述的代码，我们会改造为：</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    id <span class="keyword">int</span></span><br><span class="line">    age <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    db <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FooOption 代表可选参数</span></span><br><span class="line"><span class="keyword">type</span> FooOption <span class="function"><span class="keyword">func</span><span class="params">(foo *Foo)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WithName 代表Name为可选参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithName</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">FooOption</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(foo *Foo)</span></span> &#123;</span><br><span class="line">      foo.name = name</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WithAge 代表age为可选参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithAge</span><span class="params">(age <span class="keyword">int</span>)</span> <span class="title">FooOption</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(foo *Foo)</span></span> &#123;</span><br><span class="line">      foo.age = age</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WithDB 代表db为可选参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDB</span><span class="params">(db <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">FooOption</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(foo *Foo)</span></span> &#123;</span><br><span class="line">      foo.db = db</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewFoo 代表初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFoo</span><span class="params">(id <span class="keyword">int</span>, options ...FooOption)</span> *<span class="title">Foo</span></span> &#123;</span><br><span class="line">   foo := &amp;Foo&#123;</span><br><span class="line">      name: <span class="string">"default"</span>,</span><br><span class="line">      id:   id,</span><br><span class="line">      age:  <span class="number">10</span>,</span><br><span class="line">      db:   <span class="literal">nil</span>,</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> _, option := <span class="keyword">range</span> options &#123;</span><br><span class="line">      option(foo)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> foo</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>我们创建了一个 FooOption 的函数类型，这个函数类型代表的函数结构是 func(foo *Foo) 。</p>
                                    <p>这个结构很简单，就是将 foo 指针传递进去，能让内部函数进行修改。然后我们针对三个初始化字段 name，age，db 定义了三个返回了 FooOption 的函数，负责修改它们：</p>
                                    <ul>
                                        <li>WithName</li>
                                        <li>WithAge</li>
                                        <li>WithDB</li>
                                    </ul>
                                    <p>以 WithName 为例，这个函数参数为 string，返回值为 FooOption。在返回值的 FooOption 中，根据参数修改了 Foo 指针。</p>
                                    <figure class="highlight go">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// WithName 代表Name为可选参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithName</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">FooOption</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(foo *Foo)</span></span> &#123;</span><br><span class="line">      foo.name = name</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>有兴趣可以看看知名爬虫框架colly-<a href="https://github.com/gocolly/colly/blob/master/colly.go#L55，构造" target="_blank" rel="noopener">https://github.com/gocolly/colly/blob/master/colly.go#L55，构造</a></p>
                                    <h3 id="巧用大括号控制变量作用域"><a href="#巧用大括号控制变量作用域" class="headerlink" title="巧用大括号控制变量作用域"></a>巧用大括号控制变量作用域</h3>
                                    <p>在写 Go 的过程中，你一定有过为 := 和 = 烦恼的时刻。一个变量，到写的时候，我还要记得前面是否已经定义过了，如果没有定义过，使用 := ，如果已经定义过，使用 =。</p>
                                    <p>当然很多时候你可能并不会犯这种错误，如果变量命名得比较好的话，我们是很容易记得这个变量前面是否有定义过的。但是更多时候，对于 err 这种通用的变量名字，你可能就不一定记得了。</p>
                                    <p><strong>这个时候，巧妙使用大括号，就能很好避免这个问题。</strong></p>
                                    <h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
                                    <ul>
                                        <li>使用 pkg/error 而不是官方 error 库</li>
                                        <li>在初始化 slice 的时候尽量补全 cap</li>
                                        <li>初始化一个类的时候，如果类的构造参数较多，尽量使用 Option 写法</li>
                                        <li>巧用大括号控制变量作用域</li>
                                    </ul>
                                    <p>这几种写法和注意事项都是我在工作和阅读开源项目中的一些总结和经验，每个经验都是对应为了解决不同的问题。虽然说 Go 已经对代码做了不少的规范和优化，但是好的代码和不那么好的代码还是有一些差距的，这些写法优化点就是其中一部分。</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-05-01 13:54:21" itemprop="dateCreated datePublished" datetime="2022-05-01T13:54:21+08:00">2022-05-01</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>2.3k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>2 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/1933258000.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> 阅读 <i class="label-arrow"></i>
                                    </a>
                                    <a href="/1933258000.html" class="post-title-link" itemprop="url">少有人走的路</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="少有人走的路"><a href="#少有人走的路" class="headerlink" title="少有人走的路"></a>少有人走的路</h2>
                                    <p>我们在生活中经常会评价一个人说这个人不成熟像个孩子，那到底什么成熟，一个人成熟与否最重要的是自律性然后是否懂得什么是真正的爱。就是当一个人学会自律，主动的要求自己用积极的心态去面对承受痛苦解决问题的时候那就是距离成熟的距离很近了。而且我们生活中大量的人就宁愿在不成熟当中徘徊宁愿在痛苦当中打转，就是不愿意走上这少有人走的路。走上这条用自律和爱，铸就通向心灵承受的道路。</p>
                                    <p>自律是解决人生问题的最重要的主要工具</p>
                                    <h2 id="全面的自律"><a href="#全面的自律" class="headerlink" title="全面的自律"></a>全面的自律</h2>
                                    <h3 id="不自律的表现"><a href="#不自律的表现" class="headerlink" title="不自律的表现"></a>不自律的表现</h3>
                                    <p>遇到问题拖延着不去主动解决回避问题，假装看不见用药物、酒精等成瘾物麻痹自己，换得一时解脱</p>
                                    <h3 id="实现自律的四个原则"><a href="#实现自律的四个原则" class="headerlink" title="实现自律的四个原则"></a>实现自律的四个原则</h3>
                                    <p>推迟满足感：父母没耐心教孩子，而企图靠吼或打骂的方式一下子解决问题。童年得不到父母爱的孩子容易缺乏安全感，而陷入“今朝有酒今朝醉”处事模式儿无法做到延迟满足。</p>
                                    <p>承担责任：必须面对自己的问题，并承担解决问题的责任</p>
                                    <ul>
                                        <li>神经官能症：患者总是为自己增加责任</li>
                                        <li>人格失调症：患者总是为自己推卸责任</li>
                                    </ul>
                                    <p>忠于事实</p>
                                    <p>越是了解事实，处理问题就越得心应手</p>
                                    <p>移情：固守自己已成型的“人生地图”用来解决一切事，不肯改变</p>
                                    <p>保持平衡：确立富有弹性的束缚机制来平衡以上三个原则保持平衡的最高原则，是放弃</p>
                                    <h2 id="爱是是自律的动力"><a href="#爱是是自律的动力" class="headerlink" title="爱是是自律的动力"></a>爱是是自律的动力</h2>
                                    <h3 id="爱的定义"><a href="#爱的定义" class="headerlink" title="爱的定义"></a>爱的定义</h3>
                                    <p>爱上人们自律的原动力，是一种未来促进自己和他人心智成熟，而不断拓展再叫我界限，实现自我完善的意愿</p>
                                    <h3 id="爱的表现"><a href="#爱的表现" class="headerlink" title="爱的表现"></a>爱的表现</h3>
                                    <p>当事人意识和潜意识中目标一致。 是一个人长期、渐进的过程，应用心灵不断的成长和心智不断成熟</p>
                                    <p>爱他人者必自爱， 爱需要付出努力</p>
                                    <p>爱一个人必须付诸行动，想爱，爱的感觉和口头的爱都不等于去爱</p>
                                    <h3 id="非爱的情况"><a href="#非爱的情况" class="headerlink" title="非爱的情况"></a>非爱的情况</h3>
                                    <h4 id="堕入情网"><a href="#堕入情网" class="headerlink" title="堕入情网"></a>堕入情网</h4>
                                    <p>堕入情网不是出于主观臆断，不是有计划、有一事的选择</p>
                                    <p>堕入情网不需要付出努力，并没有真正拓展自我界限</p>
                                    <p>堕入情网不是出于可以消除寂寞，但无法有目的促进心灵</p>
                                    <h4 id="过分依赖"><a href="#过分依赖" class="headerlink" title="过分依赖"></a>过分依赖</h4>
                                    <p>没有他/她我就活不下去，是一种寄生心理，而不是爱症状有忍受的寂寞，空虚感强烈</p>
                                    <p>把失去伴侣当成极其恐怖的事情</p>
                                    <h4 id="精神灌注"><a href="#精神灌注" class="headerlink" title="精神灌注"></a>精神灌注</h4>
                                    <p>不能给心灵带来滋养的精神关注都不是爱</p>
                                    <p>爱金钱、爱权利、爱宠物、爱园艺都被称为“爱”</p>
                                    <p>如果这些爱好中增长了知识，活的了自我界限的拓宽，是爱，否则就不是爱</p>
                                    <h4 id="自我牺牲"><a href="#自我牺牲" class="headerlink" title="自我牺牲"></a>自我牺牲</h4>
                                    <p>给予者以 “爱”作为幌子，满足自己的付出欲。不将对方的心智成熟当回事</p>
                                    <h4 id="爱的体现"><a href="#爱的体现" class="headerlink" title="爱的体现"></a>爱的体现</h4>
                                    <p>关注：努力聆听，帮助对方成长</p>
                                    <p>不惧风险：不要因为害怕失去就放弃爱</p>
                                    <p>独立：人生唯一的安全感，来自于成分体验人生的不安全感保持自己独立，也许伴侣独立</p>
                                    <p>充分透入：由承担来推动，持续或渐渐增多的投入是爱的基石，给对方以安全感</p>
                                    <p>勤于自律，平等交流：当感觉矛盾与冲突时，用恰当的语言提出想法，而非使用自大的态度随意批评</p>
                                    <p>懂得自律：真正的爱必然懂得约束自己，并促进双发心智的成熟，真正的爱对自己的约束力，容不下第三者，对伴侣和孩子和孩子负有责任感</p>
                                    <h3 id="自我界限"><a href="#自我界限" class="headerlink" title="自我界限"></a>自我界限</h3>
                                    <h4 id="自我界限的设立"><a href="#自我界限的设立" class="headerlink" title="自我界限的设立"></a>自我界限的设立</h4>
                                    <p>0-7个月，婴儿分辨与外部 世界</p>
                                    <p>1岁：婴儿开始意识到自己和外界的区别，明白“我”是什么，什么不是“我”</p>
                                    <p>2-3岁：从界限不明，以为自己无所不能，到开始明白自己能力有限，有了自我界限，开始感到孤独</p>
                                    <h4 id="自我界限的暂时崩溃"><a href="#自我界限的暂时崩溃" class="headerlink" title="自我界限的暂时崩溃"></a>自我界限的暂时崩溃</h4>
                                    <p>坠入情网意味着意味着自我界限的某一部分突然崩溃，人有体会到了小时候无所不能的感觉，所以兴奋不已。等到冷静下来，发现彼此的问题，各自的自我界限又再次合拢</p>
                                    <h4 id="自我界限的拓宽"><a href="#自我界限的拓宽" class="headerlink" title="自我界限的拓宽"></a>自我界限的拓宽</h4>
                                    <p>走出舒适区，努力为一件事情付出，对自我边界形成永久性的扩张，实现自我正常</p>
                                    <h3 id="信仰与恩典"><a href="#信仰与恩典" class="headerlink" title="信仰与恩典"></a>信仰与恩典</h3>
                                    <p>盲目地认为宗教信仰有助于或有害于个人心智的成熟与健康，都不是我们应有的态度，因人而异，因事而异。</p>
                                    <p>生命中出现的恩典与奇迹，虽不能尽数解释，也应当理智对待。</p>
                                    <h3 id="阻碍成熟的障碍—懒惰"><a href="#阻碍成熟的障碍—懒惰" class="headerlink" title="阻碍成熟的障碍—懒惰"></a>阻碍成熟的障碍—懒惰</h3>
                                    <p>逃避痛苦的原动力</p>
                                    <p>恐惧直面问题的麻烦和痛苦，是懒惰的深层原因</p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-04-30 20:38:36" itemprop="dateCreated datePublished" datetime="2022-04-30T20:38:36+08:00">2022-04-30</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.5k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/2352241434.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> GC <i class="label-arrow"></i>
                                    </a>
                                    <a href="/2352241434.html" class="post-title-link" itemprop="url">GC垃圾回收原理</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="如何判断对象是垃圾"><a href="#如何判断对象是垃圾" class="headerlink" title="如何判断对象是垃圾"></a>如何判断对象是垃圾</h2>
                                    <h3 id="经典判断方法-1：引用计数法"><a href="#经典判断方法-1：引用计数法" class="headerlink" title="经典判断方法 1：引用计数法"></a>经典判断方法 1：引用计数法</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxyvrbqaj20ev07ymxp.jpg" alt=""></p>
                                    <p>思路很简单，但是如果出现循环引用，即 A 引用 B，B 又引用 A，这种情况下就不好办了。所以一般还使用了另一种称为“可达性分析”的判断方法。</p>
                                    <h3 id="经典判断方法-2：可达性分析"><a href="#经典判断方法-2：可达性分析" class="headerlink" title="经典判断方法 2：可达性分析"></a>经典判断方法 2：可达性分析</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxyyymz2j20hj084mxt.jpg" alt=""></p>
                                    <p>如果 A 引用 B，B 又引用 A（发生了循环引用问题），这 2 个对象是否能被 GC回收？</p>
                                    <p>关键不是在于 A、B 之间是否有引用，而是 A、B 是否可以一直向上追溯到 GC Roots。如果与 GC Roots 没有关联，则会被回收；否则，将继续存活。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxz0rom5j20g405sjrs.jpg" alt=""></p>
                                    <p>上图是一个用“可达性分析”标记垃圾对象的示例图，灰色的对象表示不可达对象，将等待回收</p>
                                    <h2 id="哪些内存区域需要-GC"><a href="#哪些内存区域需要-GC" class="headerlink" title="哪些内存区域需要 GC"></a>哪些内存区域需要 GC</h2>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxz5gnwtj20m80ccab1.jpg" alt=""></p>
                                    <h2 id="常用的-4-种-GC-算法"><a href="#常用的-4-种-GC-算法" class="headerlink" title="常用的 4 种 GC 算法"></a>常用的 4 种 GC 算法</h2>
                                    <h3 id="mark-sweep-标记清除法"><a href="#mark-sweep-标记清除法" class="headerlink" title="mark-sweep 标记清除法"></a>mark-sweep 标记清除法</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxz88d9ej20iu0adjrm.jpg" alt=""></p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry2t0q3mj20iu0adjrm.jpg" alt=""></p>
                                    <p>黑色区域表示待清理的垃圾对象，标记出来后直接清空。</p>
                                    <p>优：简单快速；</p>
                                    <p>缺：产生很多内存碎片。</p>
                                    <h3 id="mark-copy-标记复制法"><a href="#mark-copy-标记复制法" class="headerlink" title="mark-copy 标记复制法"></a>mark-copy 标记复制法</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxzb2sivj20j90aoq37.jpg" alt=""></p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxzdg4ivj20j90aoq37.jpg" alt=""></p>
                                    <p>思路也很简单，将内存对半分，总是保留一块空着（上图中的右侧），将左侧存活的对象（浅灰色区域）复制到右侧，然后左侧全部清空。</p>
                                    <p>优：避免了内存碎片问题；</p>
                                    <p>缺：内存浪费很严重，相当于只能使用 50% 的内存。</p>
                                    <h3 id="mark-compact-标记-整理（也称标记-压缩）法"><a href="#mark-compact-标记-整理（也称标记-压缩）法" class="headerlink" title="mark-compact 标记-整理（也称标记-压缩）法"></a>mark-compact 标记-整理（也称标记-压缩）法</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxzfpp7mj20j30akweq.jpg" alt=""></p>
                                    <p>将垃圾对象清理掉后，同时将剩下的存活对象进行整理挪动（类似于 windows 的磁盘碎片整理），保证它们占用的空间连续。</p>
                                    <p>优：节约了内存，并避免了内存碎片问题。</p>
                                    <p>缺：整理过程会降低 GC 的效率。</p>
                                    <p>上述三种算法，每种都有各自的优缺点，都不完美；在现代 JVM 中，往往是综合使用的。经过大量实际分析，发现内存中的对象，大致可以分为两类：</p>
                                    <p>有些生命周期很短，比如一些局部变量/临时对象；</p>
                                    <p>而另一些则会存活很久，典型的比如 websocket 长连接中的 connection 对象。如下图，纵向 y 轴可以理解分配内存的字节数，横向 x 轴理解为随着时间流逝（伴随着 GC）。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1rxzjx0woj20km0e9dge.jpg" alt=""></p>
                                    <p>可以发现大部分对象其实相当短命，很少有对象能在 GC 后活下来，因此诞生了分代的思想。</p>
                                    <h3 id="generation-collect-分代收集算法"><a href="#generation-collect-分代收集算法" class="headerlink" title="generation-collect 分代收集算法"></a>generation-collect 分代收集算法</h3>
                                    <p>如下图所示，可以将内存分成了三大块：年青代（Young Genaration）、老年代（Old Generation）、永久代（Permanent Generation）。其中 Young Genaration 更是又细为分<br>eden、S0、S1 三个区。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry01acb0j20ns0723z4.jpg" alt=""></p>
                                    <p>结合我们经常使用的一些 jvm 调优参数后，一些参数能影响的各区域内存大小值，示意图如下：</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry02qg80j20u00jnjsq.jpg" alt=""></p>
                                    <h2 id="GC-的主要过程"><a href="#GC-的主要过程" class="headerlink" title="GC 的主要过程"></a>GC 的主要过程</h2>
                                    <p>刚开始时，对象分配在 eden 区，s0（即：from）及 s1（即：to）区几乎是空着。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0lve2fj20ky0cw74z.jpg" alt=""></p>
                                    <p>随着应用的运行，越来越多的对象被分配到 eden 区。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry3fxogzj20jm0cqgmc.jpg" alt=""></p>
                                    <p>当 eden 区放不下时，就会发生 minor GC（也被称为 young GC）。</p>
                                    <p>首先当然是要先标识出不可达垃圾对象（即下图中的黄色块）；</p>
                                    <p>然后将可达对象，移动到 s0 区（即：4个淡蓝色的方块挪到s0区）；</p>
                                    <p>然后将黄色的垃圾块清理掉，这一轮后 eden 区就成空的了。</p>
                                    <p>注：这里其实已经综合运用了“【标记-清理eden】+【标记-复制 eden-&gt;s0】”算法。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0nc0w7j20m60bq3zi.jpg" alt=""></p>
                                    <p>随着时间推移，eden 如果又满了，再次触发 minor GC，同样还是先做标记，这时 eden 和 s0 区可能都有垃圾对象了（下图中的黄色块）。</p>
                                    <p>这时 s1（即：to）区是空的，s0 区和 eden 区的存活对象，将直接搬到 s1 区。</p>
                                    <p>然后将 eden 和 s0 区的垃圾清理掉，这一轮 minor GC 后，eden 和 s0 区就变成了空的了。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0rz9rhj20ly0dcdgv.jpg" alt=""></p>
                                    <p>继续随着对象的不断分配，eden 空可能又满了，这时会重复刚才的 minor GC 过程。不过要注意的是：</p>
                                    <p>这时候 s0 是空的，所以 s0 与 s1 的角色其实会互换。即存活的对象，会从 eden 和 s1 区，向 s0 区移动。</p>
                                    <p>然后再把 eden 和 s1 区中的垃圾清除，这一轮完成后，eden 与 s1 区变成空的，如下图。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0woahuj20li0dg3zk.jpg" alt=""></p>
                                    <h3 id="代龄与晋升"><a href="#代龄与晋升" class="headerlink" title="代龄与晋升"></a>代龄与晋升</h3>
                                    <p>对于那些比较“长寿”的对象一直在 s0 与 s1 中挪来挪去，一来很占地方，而且也会造成一定开销，降低 gc 效率，于是有了“代龄(age)”及“晋升”。</p>
                                    <p>对象在年青代的 3 个区（edge,s0,s1）之间，每次从一个区移到另一区，年龄 +1，在 young 区达到一定的年龄阈值后，将晋升到老年代。</p>
                                    <p>下图中是 8，即挪动 8 次后，如果还活着，下次 minor GC 时，将移动到 Tenured 区。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0xlvk2j20ke0eujsh.jpg" alt=""></p>
                                    <h3 id="晋升的主要过程"><a href="#晋升的主要过程" class="headerlink" title="晋升的主要过程"></a>晋升的主要过程</h3>
                                    <p>下图是晋升的主要过程：对象先分配在年青代，经过多次 Young GC 后，如果对象还活着，晋升到老年代。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry0zgme5j20de0ew74o.jpg" alt=""></p>
                                    <p>如果老年代，最终也放满了，就会发生 major GC（即 Full GC）。由于老年代的的对象通常会比较多，标记-清理-整理（压缩）的耗时通常也会比较长，会让应用出现卡顿的现象。这也就是为什么很多应用要优化，尽量避免或减少 Full GC<br>的原因。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry11sat4j20jm0g8gmj.jpg" alt=""></p>
                                    <p>注：上面的过程主要来自 oracle 官网的资料，但是有一个细节官网没有提到：如果分配的新对象比较大，eden 区放不下，但是 old 区可以放下时，会直接分配到 old 区。</p>
                                    <p>即没有晋升这一过程，直接到老年代了。</p>
                                    <h3 id="GC-流程图"><a href="#GC-流程图" class="headerlink" title="GC 流程图"></a>GC 流程图</h3>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry13l204j20j90hg0ty.jpg" alt=""></p>
                                    <h2 id="8-种垃圾回收器"><a href="#8-种垃圾回收器" class="headerlink" title="8 种垃圾回收器"></a>8 种垃圾回收器</h2>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry16k2irj219a0mijt1.jpg" alt=""></p>
                                    <p>这些回收器都是基于分代的，把 G1 除外，按回收的分代划分如下。</p>
                                    <p>横线以上的 3 种：Serial、ParNew、Parellel Scavenge 都是回收年青代的；</p>
                                    <p>横线以下的 3 种：CMS、Serial Old、Parallel Old 都是回收老年代的。</p>
                                    <p>接下来，我们将以上提到的 8 种垃圾回收器逐一讲解，其中 CMS、G1、ZGC 这三种收集器是面试考试重点，我也会着重讲解。</p>
                                    <h3 id="Serial-收集器"><a href="#Serial-收集器" class="headerlink" title="Serial 收集器"></a>Serial 收集器</h3>
                                    <p>&#x20;单线程用标记-复制算法，快刀斩乱麻，单线程的好处避免上下文切换，早期的机器，大多是单核，也比较实用。但执行期间会发生 STW（Stop The World）。</p>
                                    <h3 id="ParNew-收集器"><a href="#ParNew-收集器" class="headerlink" title="ParNew 收集器"></a>ParNew 收集器</h3>
                                    <p>Serial 的多线程版本，也同样会 STW，在多核机器上会更适用。</p>
                                    <h3 id="Parallel-Scavenge-收集器"><a href="#Parallel-Scavenge-收集器" class="headerlink" title="Parallel Scavenge 收集器"></a>Parallel Scavenge 收集器</h3>
                                    <p>ParNew 的升级版本，主要区别在于提供了两个参数：</p>
                                    <p>-XX:MaxGCPauseMillis 最大垃圾回收停顿时间；</p>
                                    <p>-XX:GCTimeRatio 垃圾回收时间与总时间占比。</p>
                                    <p>通过这 2 个参数，可以适当控制回收的节奏，更关注于吞吐率，即总时间与垃圾回收时间的比例。</p>
                                    <h3 id="Serial-Old-收集器"><a href="#Serial-Old-收集器" class="headerlink" title="Serial Old 收集器"></a>Serial Old 收集器</h3>
                                    <p>因为老年代的对象通常比较多，占用的空间通常也会更大。如果采用复制算法，得留 50% 的空间用于复制，相当不划算；而且因为对象多，从一个区，复制到另一个区，耗时也会比较长。</p>
                                    <p>所以老年代的收集，通常会采用“标记-整理”法。从名字就可以看出来，这是单线程（串行）的， 依然会有 STW。</p>
                                    <h3 id="Parallel-Old-收集器"><a href="#Parallel-Old-收集器" class="headerlink" title="Parallel Old 收集器"></a>Parallel Old 收集器</h3>
                                    <p>一句话：Serial Old 的多线程版本。</p>
                                    <h3 id="CMS-收集器"><a href="#CMS-收集器" class="headerlink" title="CMS 收集器"></a>CMS 收集器</h3>
                                    <p>Concurrent Mark Sweep，从名字上看，就能猜出它是并发多线程的。这是 JDK 7 中广泛使用的收集器，有必要多说一下。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1b60glj20u00jbjsz.jpg" alt=""></p>
                                    <h3 id="G1-收集器"><a href="#G1-收集器" class="headerlink" title="G1 收集器"></a>G1 收集器</h3>
                                    <p>鉴于 CMS 的一些不足之外，比如：老年代内存碎片化，STW 时间虽然已经改善了很多，但是仍然有提升空间。G1 就横空出世了，它对于 heap 区的内存划思路很新颖，有点算法中分治法“分而治之”的味道。</p>
                                    <blockquote>
                                        <p>G1 的全称是 Garbage-First</p>
                                    </blockquote>
                                    <h4 id="G1-垃圾收集器的原理"><a href="#G1-垃圾收集器的原理" class="headerlink" title="G1 垃圾收集器的原理"></a>G1 垃圾收集器的原理</h4>
                                    <p>如下图，G1 将 heap 内存区，划分为一个个大小相等（1-32M，2的 n 次方）、内存连续的 Region 区域，每个 region 都对应 Eden、Survivor 、Old、Humongous 四种角色之一，但是 region<br>与 region 之间不要求连续。</p>
                                    <blockquote>
                                        <p>注：Humongous，简称 H 区是专用于存放超大对象的区域，通常 &gt;= 1/2 Region Size，且只有 Full GC 阶段，才会回收 H 区，避免了频繁扫描、复制/移动大对象。</p>
                                    </blockquote>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1bnt2nj20u00afq3t.jpg" alt=""></p>
                                    <p>所有的垃圾回收，都是基于 1 个个 region 的。JVM 内部知道，哪些 region 的对象最少（即该区域最空），总是会优先收集这些 region（因为对象少，内存相对较空，肯定快）。这就是 Garbage-First 得名的由来，G<br>即是 Garbage 的缩写，1 即 First。</p>
                                    <ol>
                                        <li>G1 Young GC young GC 前：</li>
                                    </ol>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry3j8ripj20k007oaan.jpg" alt=""></p>
                                    <p>young GC 后：</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1efxdfj20k007eaak.jpg" alt=""></p>
                                    <p>理论上讲，只要有一个 Empty Region（空区域），就可以进行垃圾回收。</p>
                                    <p>由于 region 与 region 之间并不要求连续，而使用 G1 的场景通常是大内存，比如 64G 甚至更大，为了提高扫描根对象和标记的效率，G1 使用了二个新的辅助存储结构：</p>
                                    <ul>
                                        <li>
                                            <p>Remembered Sets：简称 RSets，用于根据每个 region 里的对象，是从哪指向过来的（即谁引用了我），每个 Region 都有独立的 RSets（Other Region -&gt; Self Region）。</p>
                                        </li>
                                        <li>
                                            <p>Collection Sets ：简称 CSets，记录了等待回收的 Region 集合，GC 时这些 Region 中的对象会被回收（copied or moved）。</p>
                                        </li>
                                    </ul>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1gs145j20gf0a1aae.jpg" alt=""></p>
                                    <p>RSets 的引入，在 YGC 时，将年青代 Region 的 RSets 做为根对象，可以避免扫描老年代的 region，能大大减轻 GC 的负担。</p>
                                    <blockquote>
                                        <p>注：在老年代收集 Mixed GC 时，RSets 记录了 Old-&gt;Old 的引用，也可以避免扫描所有 Old 区。</p>
                                    </blockquote>
                                    <p>Old Generation Collection（也称为 Mixed GC）</p>
                                    <p>按 oracle 官网文档描述，分为 5 个阶段：Initial Mark(STW) -&gt; Root Region Scan -&gt; Cocurrent Marking -&gt; Remark(STW) -&gt; Copying/Cleanup(<br>STW &amp;&amp; Concurrent)</p>
                                    <blockquote>
                                        <p>注：也有很多文章会把 Root Region Scan 省略掉，合并到 Initial Mark 里，变成 4 个阶段。</p>
                                    </blockquote>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1iktitj20dh09aaa9.jpg" alt=""></p>
                                    <p>阶段 1：存活对象的“初始标记”依赖于 Young GC，GC 日志中会记录成 young 字样。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1mixvuj20dm0983yt.jpg" alt=""></p>
                                    <p>阶段 2：并发标记过程中，如果发现某些 region 全是空的，会被直接清除。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1nh65sj20dc09574h.jpg" alt=""></p>
                                    <p>阶段 3：进入重新标记阶段。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1o63q3j20di097jrs.jpg" alt=""></p>
                                    <p>阶段 4：并发复制/清查阶段。这个阶段，Young 区和 Old 区的对象有可能会被同时清理。GC 日志中，会记录为 mixed 字段，这也是 G1 的老年代收集，也称为 Mixed GC 的原因。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry3mdckmj20dc097aa8.jpg" alt=""></p>
                                    <p>上图是，老年代收集完后的示意图。</p>
                                    <p>通过这几个阶段的分析，虽然看上去很多阶段仍然会发生 STW，但是 G1 提供了一个预测模型，通过统计方法，根据历史数据来预测本次收集，需要选择多少个 Region 来回收，尽量满足用户的预期停顿值（-XX:MaxGCPauseMillis<br>参数可指定预期停顿值）。</p>
                                    <blockquote>
                                        <p>注：如果 Mixed GC 仍然效果不理想，跟不上新对象分配内存的需求，会使用 Serial Old GC（Full GC）强制收集整个 Heap。</p>
                                    </blockquote>
                                    <p>小结：与 CMS 相比，G1 有内存整理过程（标记-压缩），避免了内存碎片；STW 时间可控（能预测 GC 停顿时间）。</p>
                                    <h3 id="ZGC（截止目前史上最好的-GC-收集器）"><a href="#ZGC（截止目前史上最好的-GC-收集器）" class="headerlink" title="ZGC（截止目前史上最好的 GC 收集器）"></a>ZGC（截止目前史上最好的 GC 收集器）</h3>
                                    <p>在 G1 的基础上，它做了如下 7 点改进</p>
                                    <p><strong>动态调整大小的 Region</strong><br>G1 中每个 Region 的大小是固定的，创建和销毁 Region，可以动态调整大小，内存使用更高效。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1poir8j208w07caa0.jpg" alt=""></p>
                                    <p><strong>不分代，干掉了 RSets</strong><br>G1 中每个 Region 需要借助额外的 RSets 来记录“谁引用了我”，占用了额外的内存空间，每次对象移动时，RSets 也需要更新，会产生开销。</p>
                                    <p><strong>带颜色的指针 Colored Pointer</strong></p>
                                    <p>这里的指针类似 Java 中的引用，意为对某块虚拟内存的引用。ZGC 采用了64位指针（注：目前只支持 linux 64 位系统），将 42-45 这 4 个 bit 位置赋予了不同含义，即所谓的颜色标志位，也换为指针的 metadata。</p>
                                    <ul>
                                        <li>
                                            <p>finalizable 位：仅 finalizer（类比 C++ 中的析构函数）可访问；</p>
                                        </li>
                                        <li>
                                            <p>remap 位：指向对象当前（最新）的内存地址，参考下面提到的relocation；</p>
                                        </li>
                                        <li>
                                            <p>marked0 &amp;&amp; marked1 位：用于标志可达对象。</p>
                                        </li>
                                    </ul>
                                    <p>这 4 个标志位，同一时刻只会有 1 个位置是 1。每当指针对应的内存数据发生变化，比如内存被移动，颜色会发生变化。</p>
                                    <p><strong>读屏障 Load Barrier</strong></p>
                                    <p>传统 GC 做标记时，为了防止其他线程在标记期间修改对象，通常会简单的 STW。而 ZGC 有了 Colored Pointer 后，引入了所谓的“读屏障”。</p>
                                    <p>当指针引用的内存正被移动时，指针上的颜色就会变化，ZGC 会先把指针更新成最新状态，然后再返回（你可以回想下 Java 中的 volatile 关键字，有异曲同工之妙）。这样仅读取该指针时，可能会略有开销，而不用将整个 heap STW。</p>
                                    <p><strong>重定位 Relocation</strong></p>
                                    <p>如下图，在标记过程中，先从 Roots 对象找到了直接关联的下级对象 1，2，4。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1rjw8kj20u0080gm0.jpg" alt=""></p>
                                    <p>然后继续向下层标记，找到了 5，8 对象， 此时已经可以判定 3，6，7 为垃圾对象。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry1y8q9zj20u0080aai.jpg" alt=""></p>
                                    <p>如果按常规思路，一般会将 8 从最右侧的 Region，移动或复制到中间的 Region，然后再将中间 Region 的 3 干掉，最后再对中间 Region 做压缩 compact 整理。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry20tepej20u00aj74t.jpg" alt=""></p>
                                    <p>但 ZGC 做得更高明，它直接将 4，5 复制到了一个空的新 Region 就完事了，然后中间的 2 个 Region 直接废弃，或理解为“释放”，作为下次回收的“新” Region。这样的好处是避免了中间 Region 的 compact<br>整理过程。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry22szyaj20u00ajq3l.jpg" alt=""></p>
                                    <p>最后，指针重新调整为正确的指向（即：remap），而且上一阶段的 remap 与下一阶段的mark是混在一起处理的，相对更高效。</p>
                                    <p><strong>多重映射 Multi-Mapping</strong></p>
                                    <p>这个优化，说实话没完全看懂，只能谈下自己的理解（如果有误，欢迎指正)。虚拟内存与实际物理内存，OS 会维护一个映射关系，才能正常使用，如下图：</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry24pjryj20gp07ujrr.jpg" alt=""></p>
                                    <p>zgc 的 64 位颜色指针，在解除映射关系时，代价较高（需要屏蔽额外的 42-45 的颜色标志位）。考虑到这 4 个标志位，同 1 时刻，只会有 1 位置成 1（如下图），另外 finalizable<br>标志位，永远不希望被解除映射绑定（可不用考虑映射问题）。</p>
                                    <p>所以剩下 3 种颜色的虚拟内存，可以都映射到同1段物理内存。即映射复用，或者更通俗点讲，本来 3 种不同颜色的指针，哪怕 0-41 位完全相同，也需要映射到 3 段不同的物理内存，现在只需要映射到同 1 段物理内存即可。</p>
                                    <p>支持 <a href="https://baike.baidu.com/item/NUMA/6906025?fr=aladdin" target="_blank" rel="noopener" title="NUMA 架构">NUMA 架构</a></p>
                                    <p>NUMA 是一种多核服务器的架构，简单来讲，一个多核服务器（比如 2core），每个 cpu 都有属于自己的存储器，会比访问另一个核的存储器会慢很多（类似于就近访问更快）。</p>
                                    <p>相对之前的 GC 算法，ZGC 首次支持了 NUMA 架构，申请堆内存时，判断当前线程属是哪个CPU在执行，然后就近申请该 CPU 能使用的内存。</p>
                                    <p>小结：革命性的 ZGC 经过上述一堆优化后，每次 GC 总体卡顿时间按官方说法&lt;10ms。</p>
                                    <blockquote>
                                        <p>注：启用 zgc，需要设置 -XX:+UnlockExperimentalVMOptions -XX:+UseZGC。</p>
                                    </blockquote>
                                    <h4 id="Remap-的流程图"><a href="#Remap-的流程图" class="headerlink" title="Remap 的流程图"></a>Remap 的流程图</h4>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ry28bcsjj20ii0b5jry.jpg" alt=""></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-04-30 19:05:41" itemprop="dateCreated datePublished" datetime="2022-04-30T19:05:41+08:00">2022-04-30</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>5.8k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>5 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/626715027.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> 抓包 <i class="label-arrow"></i>
                                    </a>
                                    <a href="/626715027.html" class="post-title-link" itemprop="url">雷电模拟器抓包配置</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <h2 id="雷电模拟器抓包配置"><a href="#雷电模拟器抓包配置" class="headerlink" title="雷电模拟器抓包配置"></a>雷电模拟器抓包配置</h2>
                                    <p>爬虫免不了抓包分析，当然也免不了中间转发相关的便捷操作。如果有一个稳定的、妥善的抓包环境。相信在爬虫开发中一定会事半功倍。</p>
                                    <p>有真机当然是最好的，同时如果爬虫开发者并没有真机。那么模拟器变成为了不二之选。当然如果支持多开的话那就更好了。</p>
                                    <p>业界比较知名的有</p>
                                    <p>MuMu模拟器:<a href="https://mumu.163.com/" target="_blank" rel="noopener">https://mumu.163.com/</a></p>
                                    <p>雷电模拟器：<a href="https://www.ldmnq.com/" target="_blank" rel="noopener">https://www.ldmnq.com/</a></p>
                                    <p>夜神模拟器：<a href="https://www.yeshen.com/" target="_blank" rel="noopener">https://www.yeshen.com/</a></p>
                                    <p>在开发爬虫的时候，我个人使用的比较多的的是雷电模拟器，因为他支持多开（虽然这之间有限制），以及抓包也有些问题。但奈何，它支持多开啊。配合 <a href="https://www.mitmproxy.org/" target="_blank" rel="noopener">Mitmproxy</a>的组件譬如<code>Mitmdump</code><br>简直不要太舒服。</p>
                                    <h3 id="雷电模拟器的安装"><a href="#雷电模拟器的安装" class="headerlink" title="雷电模拟器的安装"></a>雷电模拟器的安装</h3>
                                    <p>首先进入官网， 如下图所示，<a href="https://www.ldmnq.com/" target="_blank" rel="noopener">https://www.ldmnq.com/</a></p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1lclkmpbjj224n0u0wu4.jpg" alt="image-20220425015741050"></p>
                                    <p>选择<a href="https://www.ldmnq.com/other/version-history-and-release-notes.html" target="_blank" rel="noopener">更新日志</a>，寻找历史版本。笔者这里使用的是3.74 较为稳定。以及支持网桥。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1lcopronuj20gy0a4wen.jpg" alt="image-20220425020045161"></p>
                                    <p><a href="https://dl.softmgr.qq.com/original/game/ldinst_3.74.0.exe" target="_blank" rel="noopener">https://dl.softmgr.qq.com/original/game/ldinst_3.74.0.exe</a></p>
                                    <p>选择3.74版本，主要是由于新版本的网桥这个bug在修复。以及完善度如何，至今不敢恭维。so，就选择较为稳定的它。</p>
                                    <blockquote>
                                        <p>必须需要支持网桥，否则无法抓包。</p>
                                    </blockquote>
                                    <h2 id="抓包工具安装"><a href="#抓包工具安装" class="headerlink" title="抓包工具安装"></a>抓包工具安装</h2>
                                    <p>抓包工具这里没什么好讲的，常规常见的都都行。</p>
                                    <p>fiddle：<a href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener">https://www.telerik.com/download/fiddler</a></p>
                                    <p>Charles： <a href="https://www.charlesproxy.com/" target="_blank" rel="noopener">https://www.charlesproxy.com/</a></p>
                                    <p>mitmproxy：<a href="https://www.mitmproxy.org/" target="_blank" rel="noopener">https://www.mitmproxy.org/</a></p>
                                    <p>都比较不错，具体选择那个请你酌情考虑。</p>
                                    <h2 id="雷电模拟器抓包配置-1"><a href="#雷电模拟器抓包配置-1" class="headerlink" title="雷电模拟器抓包配置"></a>雷电模拟器抓包配置</h2>
                                    <p>首先新建一个雷电模拟器，如下图所示。以及网桥设置如下。</p>
                                    <p><strong>当然记得安装桥接的驱动</strong>。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1lcw8lt5wj20ui0u0juc.jpg" alt="image-20220425020758810"></p>
                                    <p>完成后，如下所示</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1lcy8j46pj20o60dygma.jpg" alt="image-20220425020954288"></p>
                                    <p>以Mitmproxy的证书为例子，如下</p>
                                    <p>首先需要安装mitmproxy,执行如下命令（在此之前需要有Python环境）</p>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">pip install mitmproxy</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>如果配置了环境变量的话，首次执行一下mitmproxy相关的命令（由于非Uinux，是没有mitmrpoxy的），所以执行<code>mitmweb</code>, 我个人建议是添加对应的端口。命令如下所示</p>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">mitmweb -p 8088</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>当然，我建议是8088，我习惯给他配置为mitm相关的抓包的端口。当然你可以选择其他的端口，当然后续操作就可能会有些许出入。</p>
                                    <p>此时，进入<code>~.mitmproxy</code> 目录下</p>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment"># windows</span></span><br><span class="line"><span class="built_in">cd</span> ~\.\.mitmproxy\</span><br><span class="line"><span class="comment"># mac or Linux</span></span><br><span class="line"><span class="built_in">cd</span> ~/.mitmproxy/</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>使用<code>ls</code> 命令即可查看到相关的证书了！。我建议是<strong>在这里寻找到证书而非mitm.it,因为在手机上很有可能上不去</strong></p>
                                    <h3 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h3>
                                    <p>在配置证书前，我强烈建议你先配置好代理端口。这将大大到降低与简化后续的操作。由于模拟器都是采用的自生的网络。直接配置WI-FI即可。如下</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ldabzy52j20oa0rwdgj.jpg" alt="image-20220425022132093"></p>
                                    <p>点击修改网络，以及高级配置，同时将代理选择为手动。如下图所示</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ldaxdedej20la10a75t.jpg" alt="image-20220425022206837"></p>
                                    <p>端口在这里我设置为<code>8088</code>, 代理服务器主机名。你可以在终端中的<code>ifconfig</code> 或者<code>ipconfig</code>,中获取。在此便不再过多赘述。</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ldbqbtpqj20kq0dk3z5.jpg" alt="image-20220425022253389"></p>
                                    <h3 id="配置证书"><a href="#配置证书" class="headerlink" title="配置证书"></a>配置证书</h3>
                                    <p>在<code>~.mitmproxy</code>下将昵称为<code>mitmproxy-ca-cert.pem</code>的文件拖入到雷电模拟器中，如下图所示</p>
                                    <blockquote>
                                        <p>将该文件移动屏幕内，即可跳转到该目录</p>
                                    </blockquote>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1lddqsvxpj21l20u0n25.jpg" alt="image-20220425022448328"></p>
                                    <p>开始配置证书，打开设置-&gt; 安全-&gt; 从SD卡安装 选择证书所在的目录。双击即可安装</p>
                                    <p>在终端中运行</p>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">mitmweb -p 8088</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>浏览百度</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ldj2cgkdj21b80u0k22.jpg" alt="image-20220425022954673"></p>
                                    <p>至此，证书就已经安装完成啦</p>
                                    <h3 id="Android-7-及以上的版本抓包"><a href="#Android-7-及以上的版本抓包" class="headerlink" title="Android 7 及以上的版本抓包"></a>Android 7 及以上的版本抓包</h3>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">mount -o rw,remount /system</span><br><span class="line">cp /data/misc/user/0/cacerts-added/269953fb.0 /system/etc/security/cacerts/</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h2>
                                    <p><a href="https://blog.csdn.net/Palmer9/article/details/119062660" target="_blank" rel="noopener">Android(4) Android7.0 配置系统证书</a></p>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-04-25 01:48:36" itemprop="dateCreated datePublished" datetime="2022-04-25T01:48:36+08:00">2022-04-25</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>1.4k</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
                            <link itemprop="mainEntityOfPage" href="https://paynewu.com/2145839287.html">
                            <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <meta itemprop="image" content="/images/favicon/android-chrome-512x512.png">
                                <meta itemprop="name" content="吴志鹏">
                                <meta itemprop="description" content="Talk is free，please state clearly">
                            </span>
                            <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                                <meta itemprop="name" content="吴志鹏｜Payne-Wu">
                            </span>
                            <header class="post-header">
                                <h2 class="post-title" itemprop="name headline">
                                    <a class="label"> command <i class="label-arrow"></i>
                                    </a>
                                    <a href="/2145839287.html" class="post-title-link" itemprop="url">Linux command多版本设置</a>
                                </h2>
                            </header>
                            <div class="post-body" itemprop="articleBody">
                                <div class="thumb">
                                    <img itemprop="contentUrl" class="random">
                                </div>
                                <div class="excerpt">
                                    <p>
                                    <p>在Linux上有这样一个需求，需要将Python的默认版本设置为<code>python3.8</code> 但由于Linux系统自带的是3.6.那么实现他只需要完成python3.8的安装，以及python命令的指向问题。</p>
                                    <p>python3.8 的安装在此便不再过多赘述，如下命令都可任选其一即可</p>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">sudo yum install -y python38 python38-pip</span><br><span class="line"></span><br><span class="line">sudo dnf install -y python38 python38-pip</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="修改指向"><a href="#修改指向" class="headerlink" title="修改指向"></a>修改指向</h2>
                                    <h3 id="alternatives-修改"><a href="#alternatives-修改" class="headerlink" title="alternatives 修改"></a>alternatives 修改</h3>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">alternatives --config python3</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>此时直接输入1，修改即可。如下图所示</p>
                                    <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h19tu6qge1j218w0ggtak.jpg" alt="image-20220415024725606"></p>
                                    <h3 id="alternatives-—install"><a href="#alternatives-—install" class="headerlink" title="alternatives —install"></a>alternatives —install</h3>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">alternatives --install &lt;链接&gt; &lt;名称&gt; &lt;路径&gt; &lt;优先度&gt;</span><br><span class="line">update-alternatives --install /usr/bin/python python /usr/bin/python2.7 2</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h3>
                                    <figure class="highlight bash">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">ln -fs /usr/bin/python3.8 /usr/bin/python3</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                </div>
                            </div>
                            <div class="post-meta">
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-user"></i>
                                    </span>
                                    <span class="post-meta-item-text">作者</span>
                                    <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                                </span>
                                <span class="post-meta-item">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-calendar"></i>
                                    </span>
                                    <span class="post-meta-item-text">发表于</span>
                                    <time title="创建时间：2022-04-15 02:35:41" itemprop="dateCreated datePublished" datetime="2022-04-15T02:35:41+08:00">2022-04-15</time>
                                </span>
                                <br>
                                <span class="post-meta-item" title="本文字数">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-file-word"></i>
                                    </span>
                                    <span class="post-meta-item-text">本文字数：</span>
                                    <span>191</span>
                                </span>
                                <span class="post-meta-item" title="阅读时长">
                                    <span class="post-meta-item-icon">
                                        <i class="far fa-clock"></i>
                                    </span>
                                    <span class="post-meta-item-text">阅读时长 &asymp;</span>
                                    <span>1 分钟</span>
                                </span>
                            </div>
                        </article>
                        <script>
                            document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

                        </script>
                        <nav class="pagination">
                            <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
                        </nav>
                    </div>
                    <script>
                        window.addEventListener('tabs:register', () =>
                        {
                            let
                            {
                                activeClass
                            } = CONFIG.comments;
                            if (CONFIG.comments.storage)
                            {
                                activeClass = localStorage.getItem('comments_active') || activeClass;
                            }
                            if (activeClass)
                            {
                                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                                if (activeTab)
                                {
                                    activeTab.click();
                                }
                            }
                        });
                        if (CONFIG.comments.storage)
                        {
                            window.addEventListener('tabs:click', event =>
                            {
                                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                                let commentClass = event.target.classList[1];
                                localStorage.setItem('comments_active', commentClass);
                            });
                        }

                    </script>
                </div>
                <div class="toggle sidebar-toggle">
                    <span class="toggle-line toggle-line-first"></span>
                    <span class="toggle-line toggle-line-middle"></span>
                    <span class="toggle-line toggle-line-last"></span>
                </div>
                <aside class="sidebar">
                    <div class="sidebar-inner">
                        <ul class="sidebar-nav motion-element">
                            <li class="sidebar-nav-toc"> 文章目录 </li>
                            <li class="sidebar-nav-overview"> 站点概览 </li>
                        </ul>
                        <!--noindex-->
                        <div class="post-toc-wrap sidebar-panel">
                        </div>
                        <!--/noindex-->
                        <div class="site-overview-wrap sidebar-panel">
                            <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                                <img class="site-author-image" itemprop="image" alt="吴志鹏" src="/images/favicon/android-chrome-512x512.png">
                                <p class="site-author-name" itemprop="name">吴志鹏</p>
                                <div class="site-description" itemprop="description">Talk is free，please state clearly</div>
                            </div>
                            <div class="site-state-wrap motion-element">
                                <nav class="site-state">
                                    <div class="site-state-item site-state-posts">
                                        <a href="/archives/">
                                            <span class="site-state-item-count">136</span>
                                            <span class="site-state-item-name">日志</span>
                                        </a>
                                    </div>
                                    <div class="site-state-item site-state-categories">
                                        <a href="/categories/">
                                            <span class="site-state-item-count">158</span>
                                            <span class="site-state-item-name">分类</span></a>
                                    </div>
                                    <div class="site-state-item site-state-tags">
                                        <a href="/tags/">
                                            <span class="site-state-item-count">89</span>
                                            <span class="site-state-item-name">标签</span></a>
                                    </div>
                                </nav>
                            </div>
                            <div class="links-of-author motion-element">
                                <span class="links-of-author-item">
                                    <a href="https://github.com/Payne-Wu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Payne-Wu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="mailto:wuzhipeng1289690157@gmail.com" title="E-Mail → mailto:wuzhipeng1289690157@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="https://www.zhihu.com/people/wu-zhi-peng-72-78" title="ZhiHu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;wu-zhi-peng-72-78" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>ZhiHu</a>
                                </span>
                                <span class="links-of-author-item">
                                    <a href="https://weibo.com/u/6987234483" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;6987234483" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </aside>
                <div id="sidebar-dimmer"></div>
            </div>
        </main>
        <footer class="footer">
            <div class="footer-inner">
                <div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span>
                    <span class="with-love">
                        <i class="fa fa-heart"></i>
                    </span>
                    <span class="author" itemprop="copyrightHolder">PayneWu</span>
                    <span class="post-meta-divider">|</span>
                    <span class="post-meta-item-icon">
                        <i class="fa fa-chart-area"></i>
                    </span>
                    <span title="站点总字数">255k</span>
                    <span class="post-meta-divider">|</span>
                    <span class="post-meta-item-icon">
                        <i class="fa fa-coffee"></i>
                    </span>
                    <span title="站点阅读时长">3:51</span>
                </div>
                <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备2021019893号-1 </a>
                </div>
                <div style="display: none;">
                    <script src="//s95.cnzz.com/z_stat.php?id=true&web_id=true"></script>
                </div>
            </div>
        </footer>
    </div>
    <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/.js"></script>
    <script src="/js/schemes/pisces.js"></script>
    <script src="/.js"></script>
    <script src="/js/next-boot.js"></script>
    <script src="/.js"></script>
    <script>
        (function ()
        {
            var canonicalURL, curProtocol;
            //Get the <link> tag
            var x = document.getElementsByTagName("link");
            //Find the last canonical URL
            if (x.length > 0)
            {
                for (i = 0; i < x.length; i++)
                {
                    if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
                    {
                        canonicalURL = x[i].href;
                    }
                }
            }
            //Get protocol
            if (!canonicalURL)
            {
                curProtocol = window.location.protocol.split(':')[0];
            }
            else
            {
                curProtocol = canonicalURL.split(':')[0];
            }
            //Get current URL if the canonical URL does not exist
            if (!canonicalURL) canonicalURL = window.location.href;
            //Assign script content. Replace current URL with the canonical URL
            ! function ()
            {
                var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
                    r = canonicalURL,
                    t = document.referrer;
                if (!e.test(r))
                {
                    var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
                    t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
                    var i = new Image;
                    i.src = n
                }
            }(window);
        })();

    </script>
    <script src="/js/local-search.js"></script>
    <script src="/.js"></script>
</body>

</html>
